import{t as wt,e as yt}from"./tslib-f21ea1b5.js";import{d as Yt,g as Po,r as Ro}from"./index-2111860c.js";import{b as ji,s as Ln,a as Mn,d as $n,i as bs,c as Fo,e as Uo,g as jn,f as zi,h as Lo,J as Dr,j as Hi,k as qi,l as Ft,m as Tt,n as zn,o as Bi,H as Jr}from"./index-cfa32616.js";function Mo(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}var $o=jo;function jo(r,e,t){var i=t&&t.stringify||Mo,s=1;if(typeof r=="object"&&r!==null){var o=e.length+s;if(o===1)return r;var u=new Array(o);u[0]=i(r);for(var c=1;c<o;c++)u[c]=i(e[c]);return u.join(" ")}if(typeof r!="string")return r;var h=e.length;if(h===0)return r;for(var w="",m=1-s,E=-1,C=r&&r.length||0,v=0;v<C;){if(r.charCodeAt(v)===37&&v+1<C){switch(E=E>-1?E:0,r.charCodeAt(v+1)){case 100:case 102:if(m>=h||e[m]==null)break;E<v&&(w+=r.slice(E,v)),w+=Number(e[m]),E=v+2,v++;break;case 105:if(m>=h||e[m]==null)break;E<v&&(w+=r.slice(E,v)),w+=Math.floor(Number(e[m])),E=v+2,v++;break;case 79:case 111:case 106:if(m>=h||e[m]===void 0)break;E<v&&(w+=r.slice(E,v));var x=typeof e[m];if(x==="string"){w+="'"+e[m]+"'",E=v+2,v++;break}if(x==="function"){w+=e[m].name||"<anonymous>",E=v+2,v++;break}w+=i(e[m]),E=v+2,v++;break;case 115:if(m>=h)break;E<v&&(w+=r.slice(E,v)),w+=String(e[m]),E=v+2,v++;break;case 37:E<v&&(w+=r.slice(E,v)),w+="%",E=v+2,v++,m--;break}++m}++v}return E===-1?r:(E<C&&(w+=r.slice(E)),w)}const ms=$o;var Sr=xt;const _r=Yo().console||{},zo={mapHttpRequest:jr,mapHttpResponse:jr,wrapRequestSerializer:hi,wrapResponseSerializer:hi,wrapErrorSerializer:hi,req:jr,res:jr,err:Vo};function Ho(r,e){return Array.isArray(r)?r.filter(function(i){return i!=="!stdSerializers.err"}):r===!0?Object.keys(e):!1}function xt(r){r=r||{},r.browser=r.browser||{};const e=r.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const t=r.browser.write||_r;r.browser.write&&(r.browser.asObject=!0);const i=r.serializers||{},s=Ho(r.browser.serialize,i);let o=r.browser.serialize;Array.isArray(r.browser.serialize)&&r.browser.serialize.indexOf("!stdSerializers.err")>-1&&(o=!1);const u=["error","fatal","warn","info","debug","trace"];typeof t=="function"&&(t.error=t.fatal=t.warn=t.info=t.debug=t.trace=t),r.enabled===!1&&(r.level="silent");const c=r.level||"info",h=Object.create(t);h.log||(h.log=Er),Object.defineProperty(h,"levelVal",{get:m}),Object.defineProperty(h,"level",{get:E,set:C});const w={transmit:e,serialize:s,asObject:r.browser.asObject,levels:u,timestamp:Go(r)};h.levels=xt.levels,h.level=c,h.setMaxListeners=h.getMaxListeners=h.emit=h.addListener=h.on=h.prependListener=h.once=h.prependOnceListener=h.removeListener=h.removeAllListeners=h.listeners=h.listenerCount=h.eventNames=h.write=h.flush=Er,h.serializers=i,h._serialize=s,h._stdErrSerialize=o,h.child=v,e&&(h._logEvent=Si());function m(){return this.level==="silent"?1/0:this.levels.values[this.level]}function E(){return this._level}function C(x){if(x!=="silent"&&!this.levels.values[x])throw Error("unknown level "+x);this._level=x,tr(w,h,"error","log"),tr(w,h,"fatal","error"),tr(w,h,"warn","error"),tr(w,h,"info","log"),tr(w,h,"debug","log"),tr(w,h,"trace","log")}function v(x,P){if(!x)throw new Error("missing bindings for child Pino");P=P||{},s&&x.serializers&&(P.serializers=x.serializers);const A=P.serializers;if(s&&A){var L=Object.assign({},i,A),l=r.browser.serialize===!0?Object.keys(L):s;delete x.serializers,Xr([x],l,L,this._stdErrSerialize)}function b(f){this._childLevel=(f._childLevel|0)+1,this.error=rr(f,x,"error"),this.fatal=rr(f,x,"fatal"),this.warn=rr(f,x,"warn"),this.info=rr(f,x,"info"),this.debug=rr(f,x,"debug"),this.trace=rr(f,x,"trace"),L&&(this.serializers=L,this._serialize=l),e&&(this._logEvent=Si([].concat(f._logEvent.bindings,x)))}return b.prototype=this,new b(this)}return h}xt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};xt.stdSerializers=zo;xt.stdTimeFunctions=Object.assign({},{nullTime:Hn,epochTime:qn,unixTime:ko,isoTime:Wo});function tr(r,e,t,i){const s=Object.getPrototypeOf(e);e[t]=e.levelVal>e.levels.values[t]?Er:s[t]?s[t]:_r[t]||_r[i]||Er,qo(r,e,t)}function qo(r,e,t){!r.transmit&&e[t]===Er||(e[t]=function(i){return function(){const o=r.timestamp(),u=new Array(arguments.length),c=Object.getPrototypeOf&&Object.getPrototypeOf(this)===_r?_r:this;for(var h=0;h<u.length;h++)u[h]=arguments[h];if(r.serialize&&!r.asObject&&Xr(u,this._serialize,this.serializers,this._stdErrSerialize),r.asObject?i.call(c,Bo(this,t,u,o)):i.apply(c,u),r.transmit){const w=r.transmit.level||e.level,m=xt.levels.values[w],E=xt.levels.values[t];if(E<m)return;Ko(this,{ts:o,methodLevel:t,methodValue:E,transmitLevel:w,transmitValue:xt.levels.values[r.transmit.level||e.level],send:r.transmit.send,val:e.levelVal},u)}}}(e[t]))}function Bo(r,e,t,i){r._serialize&&Xr(t,r._serialize,r.serializers,r._stdErrSerialize);const s=t.slice();let o=s[0];const u={};i&&(u.time=i),u.level=xt.levels.values[e];let c=(r._childLevel|0)+1;if(c<1&&(c=1),o!==null&&typeof o=="object"){for(;c--&&typeof s[0]=="object";)Object.assign(u,s.shift());o=s.length?ms(s.shift(),s):void 0}else typeof o=="string"&&(o=ms(s.shift(),s));return o!==void 0&&(u.msg=o),u}function Xr(r,e,t,i){for(const s in r)if(i&&r[s]instanceof Error)r[s]=xt.stdSerializers.err(r[s]);else if(typeof r[s]=="object"&&!Array.isArray(r[s]))for(const o in r[s])e&&e.indexOf(o)>-1&&o in t&&(r[s][o]=t[o](r[s][o]))}function rr(r,e,t){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var s=1;s<i.length;s++)i[s]=arguments[s-1];return r[t].apply(this,i)}}function Ko(r,e,t){const i=e.send,s=e.ts,o=e.methodLevel,u=e.methodValue,c=e.val,h=r._logEvent.bindings;Xr(t,r._serialize||Object.keys(r.serializers),r.serializers,r._stdErrSerialize===void 0?!0:r._stdErrSerialize),r._logEvent.ts=s,r._logEvent.messages=t.filter(function(w){return h.indexOf(w)===-1}),r._logEvent.level.label=o,r._logEvent.level.value=u,i(o,r._logEvent,c),r._logEvent=Si(h)}function Si(r){return{ts:0,messages:[],bindings:r||[],level:{label:"",value:0}}}function Vo(r){const e={type:r.constructor.name,msg:r.message,stack:r.stack};for(const t in r)e[t]===void 0&&(e[t]=r[t]);return e}function Go(r){return typeof r.timestamp=="function"?r.timestamp:r.timestamp===!1?Hn:qn}function jr(){return{}}function hi(r){return r}function Er(){}function Hn(){return!1}function qn(){return Date.now()}function ko(){return Math.round(Date.now()/1e3)}function Wo(){return new Date(Date.now()).toISOString()}function Yo(){function r(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return r(self)||r(window)||r(this)||{}}}var Zr={},xr={};Object.defineProperty(xr,"__esModule",{value:!0});function Jo(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return JSON.parse(r)}catch{return r}}xr.safeJsonParse=Jo;function Xo(r){return typeof r=="string"?r:JSON.stringify(r,(e,t)=>typeof t>"u"?null:t)}xr.safeJsonStringify=Xo;var Kr={},ui={get exports(){return Kr},set exports(r){Kr=r}},ws;function Zo(){return ws||(ws=1,function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,i){this[t]=String(i)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(i){t[i]=void 0,delete t[i]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Yt<"u"&&Yt.localStorage?ui.exports=Yt.localStorage:typeof window<"u"&&window.localStorage?ui.exports=window.localStorage:ui.exports=new e}()),Kr}var li={},lr={},_s;function Qo(){if(_s)return lr;_s=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.IKeyValueStorage=void 0;class r{}return lr.IKeyValueStorage=r,lr}var fr={},Es;function ec(){if(Es)return fr;Es=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.parseEntry=void 0;const r=xr;function e(t){var i;return[t[0],r.safeJsonParse((i=t[1])!==null&&i!==void 0?i:"")]}return fr.parseEntry=e,fr}var vs;function tc(){return vs||(vs=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=wt;e.__exportStar(Qo(),r),e.__exportStar(ec(),r)}(li)),li}Object.defineProperty(Zr,"__esModule",{value:!0});Zr.KeyValueStorage=void 0;const sr=wt,Ds=xr,rc=sr.__importDefault(Zo()),ic=tc();class Bn{constructor(){this.localStorage=rc.default}getKeys(){return sr.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return sr.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(ic.parseEntry)})}getItem(e){return sr.__awaiter(this,void 0,void 0,function*(){const t=this.localStorage.getItem(e);if(t!==null)return Ds.safeJsonParse(t)})}setItem(e,t){return sr.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,Ds.safeJsonStringify(t))})}removeItem(e){return sr.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}Zr.KeyValueStorage=Bn;var sc=Zr.default=Bn,Ir={},dr={},Z={},fi={},gr={},Ss;function nc(){if(Ss)return gr;Ss=1,Object.defineProperty(gr,"__esModule",{value:!0}),gr.delay=void 0;function r(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}return gr.delay=r,gr}var Kt={},di={},Vt={},xs;function ac(){return xs||(xs=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.ONE_THOUSAND=Vt.ONE_HUNDRED=void 0,Vt.ONE_HUNDRED=100,Vt.ONE_THOUSAND=1e3),Vt}var gi={},Is;function oc(){return Is||(Is=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ONE_YEAR=r.FOUR_WEEKS=r.THREE_WEEKS=r.TWO_WEEKS=r.ONE_WEEK=r.THIRTY_DAYS=r.SEVEN_DAYS=r.FIVE_DAYS=r.THREE_DAYS=r.ONE_DAY=r.TWENTY_FOUR_HOURS=r.TWELVE_HOURS=r.SIX_HOURS=r.THREE_HOURS=r.ONE_HOUR=r.SIXTY_MINUTES=r.THIRTY_MINUTES=r.TEN_MINUTES=r.FIVE_MINUTES=r.ONE_MINUTE=r.SIXTY_SECONDS=r.THIRTY_SECONDS=r.TEN_SECONDS=r.FIVE_SECONDS=r.ONE_SECOND=void 0,r.ONE_SECOND=1,r.FIVE_SECONDS=5,r.TEN_SECONDS=10,r.THIRTY_SECONDS=30,r.SIXTY_SECONDS=60,r.ONE_MINUTE=r.SIXTY_SECONDS,r.FIVE_MINUTES=r.ONE_MINUTE*5,r.TEN_MINUTES=r.ONE_MINUTE*10,r.THIRTY_MINUTES=r.ONE_MINUTE*30,r.SIXTY_MINUTES=r.ONE_MINUTE*60,r.ONE_HOUR=r.SIXTY_MINUTES,r.THREE_HOURS=r.ONE_HOUR*3,r.SIX_HOURS=r.ONE_HOUR*6,r.TWELVE_HOURS=r.ONE_HOUR*12,r.TWENTY_FOUR_HOURS=r.ONE_HOUR*24,r.ONE_DAY=r.TWENTY_FOUR_HOURS,r.THREE_DAYS=r.ONE_DAY*3,r.FIVE_DAYS=r.ONE_DAY*5,r.SEVEN_DAYS=r.ONE_DAY*7,r.THIRTY_DAYS=r.ONE_DAY*30,r.ONE_WEEK=r.SEVEN_DAYS,r.TWO_WEEKS=r.ONE_WEEK*2,r.THREE_WEEKS=r.ONE_WEEK*3,r.FOUR_WEEKS=r.ONE_WEEK*4,r.ONE_YEAR=r.ONE_DAY*365}(gi)),gi}var Os;function Kn(){return Os||(Os=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=wt;e.__exportStar(ac(),r),e.__exportStar(oc(),r)}(di)),di}var As;function cc(){if(As)return Kt;As=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.fromMiliseconds=Kt.toMiliseconds=void 0;const r=Kn();function e(i){return i*r.ONE_THOUSAND}Kt.toMiliseconds=e;function t(i){return Math.floor(i/r.ONE_THOUSAND)}return Kt.fromMiliseconds=t,Kt}var Ts;function hc(){return Ts||(Ts=1,function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=wt;e.__exportStar(nc(),r),e.__exportStar(cc(),r)}(fi)),fi}var ir={},Ns;function uc(){if(Ns)return ir;Ns=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.Watch=void 0;class r{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t))throw new Error(`Watch already started for label: ${t}`);this.timestamps.set(t,{started:Date.now()})}stop(t){const i=this.get(t);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${t}`);const s=Date.now()-i.started;this.timestamps.set(t,{started:i.started,elapsed:s})}get(t){const i=this.timestamps.get(t);if(typeof i>"u")throw new Error(`No timestamp found for label: ${t}`);return i}elapsed(t){const i=this.get(t);return i.elapsed||Date.now()-i.started}}return ir.Watch=r,ir.default=r,ir}var pi={},pr={},Cs;function lc(){if(Cs)return pr;Cs=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.IWatch=void 0;class r{}return pr.IWatch=r,pr}var Ps;function fc(){return Ps||(Ps=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),wt.__exportStar(lc(),r)}(pi)),pi}(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=wt;e.__exportStar(hc(),r),e.__exportStar(uc(),r),e.__exportStar(fc(),r),e.__exportStar(Kn(),r)})(Z);var yi={},yr={};class Jt{}const dc=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Jt},Symbol.toStringTag,{value:"Module"})),gc=Po(dc);var Rs;function pc(){if(Rs)return yr;Rs=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr.IHeartBeat=void 0;const r=gc;class e extends r.IEvents{constructor(i){super()}}return yr.IHeartBeat=e,yr}var Fs;function Vn(){return Fs||(Fs=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),wt.__exportStar(pc(),r)}(yi)),yi}var bi={},Gt={},Us;function yc(){if(Us)return Gt;Us=1,Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.HEARTBEAT_EVENTS=Gt.HEARTBEAT_INTERVAL=void 0;const r=Z;return Gt.HEARTBEAT_INTERVAL=r.FIVE_SECONDS,Gt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Gt}var Ls;function Gn(){return Ls||(Ls=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),wt.__exportStar(yc(),r)}(bi)),bi}var Ms;function bc(){if(Ms)return dr;Ms=1,Object.defineProperty(dr,"__esModule",{value:!0}),dr.HeartBeat=void 0;const r=wt,e=yt,t=Z,i=Vn(),s=Gn();class o extends i.IHeartBeat{constructor(c){super(c),this.events=new e.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(c==null?void 0:c.interval)||s.HEARTBEAT_INTERVAL}static init(c){return r.__awaiter(this,void 0,void 0,function*(){const h=new o(c);return yield h.init(),h})}init(){return r.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(c,h){this.events.on(c,h)}once(c,h){this.events.once(c,h)}off(c,h){this.events.off(c,h)}removeListener(c,h){this.events.removeListener(c,h)}initialize(){return r.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),t.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return dr.HeartBeat=o,dr}(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=wt;e.__exportStar(bc(),r),e.__exportStar(Vn(),r),e.__exportStar(Gn(),r)})(Ir);var Se={},kt={},$s;function kn(){return $s||($s=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.PINO_CUSTOM_CONTEXT_KEY=kt.PINO_LOGGER_DEFAULTS=void 0,kt.PINO_LOGGER_DEFAULTS={level:"info"},kt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),kt}var st={},js;function mc(){if(js)return st;js=1,Object.defineProperty(st,"__esModule",{value:!0}),st.generateChildLogger=st.formatChildLoggerContext=st.getLoggerContext=st.setBrowserLoggerContext=st.getBrowserLoggerContext=st.getDefaultLoggerOptions=void 0;const r=kn();function e(c){return Object.assign(Object.assign({},c),{level:(c==null?void 0:c.level)||r.PINO_LOGGER_DEFAULTS.level})}st.getDefaultLoggerOptions=e;function t(c,h=r.PINO_CUSTOM_CONTEXT_KEY){return c[h]||""}st.getBrowserLoggerContext=t;function i(c,h,w=r.PINO_CUSTOM_CONTEXT_KEY){return c[w]=h,c}st.setBrowserLoggerContext=i;function s(c,h=r.PINO_CUSTOM_CONTEXT_KEY){let w="";return typeof c.bindings>"u"?w=t(c,h):w=c.bindings().context||"",w}st.getLoggerContext=s;function o(c,h,w=r.PINO_CUSTOM_CONTEXT_KEY){const m=s(c,w);return m.trim()?`${m}/${h}`:h}st.formatChildLoggerContext=o;function u(c,h,w=r.PINO_CUSTOM_CONTEXT_KEY){const m=o(c,h,w),E=c.child({context:m});return i(E,m,w)}return st.generateChildLogger=u,st}(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.pino=void 0;const e=wt,t=e.__importDefault(Sr);Object.defineProperty(r,"pino",{enumerable:!0,get:function(){return t.default}}),e.__exportStar(kn(),r),e.__exportStar(mc(),r)})(Se);class wc extends Jt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let _c=class extends Jt{constructor(e,t){super(),this.core=e,this.logger=t,this.records=new Map}},Ec=class{constructor(e,t){this.logger=e,this.core=t}},vc=class extends Jt{constructor(e,t){super(),this.relayer=e,this.logger=t}};class Dc extends Jt{constructor(e){super()}}let Sc=class{constructor(e,t,i,s){this.core=e,this.logger=t,this.name=i}};class xc extends Jt{constructor(e,t){super(),this.relayer=e,this.logger=t}}let Ic=class extends Jt{constructor(e,t){super(),this.core=e,this.logger=t}},Oc=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},Ac=class{constructor(e){this.client=e}};var Ki={},nr={},Qr={},ei={};Object.defineProperty(ei,"__esModule",{value:!0});ei.BrowserRandomSource=void 0;const zs=65536;class Tc{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const t=new Uint8Array(e);for(let i=0;i<t.length;i+=zs)this._crypto.getRandomValues(t.subarray(i,i+Math.min(t.length-i,zs)));return t}}ei.BrowserRandomSource=Tc;function Nc(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ti={},lt={};Object.defineProperty(lt,"__esModule",{value:!0});function Cc(r){for(var e=0;e<r.length;e++)r[e]=0;return r}lt.wipe=Cc;Object.defineProperty(ti,"__esModule",{value:!0});ti.NodeRandomSource=void 0;const Pc=lt;class Rc{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Nc<"u"){const e=Ro;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let s=0;s<i.length;s++)i[s]=t[s];return(0,Pc.wipe)(t),i}}ti.NodeRandomSource=Rc;Object.defineProperty(Qr,"__esModule",{value:!0});Qr.SystemRandomSource=void 0;const Fc=ei,Uc=ti;class Lc{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Fc.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Uc.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Qr.SystemRandomSource=Lc;var re={},Wn={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});function e(c,h){var w=c>>>16&65535,m=c&65535,E=h>>>16&65535,C=h&65535;return m*C+(w*C+m*E<<16>>>0)|0}r.mul=Math.imul||e;function t(c,h){return c+h|0}r.add=t;function i(c,h){return c-h|0}r.sub=i;function s(c,h){return c<<h|c>>>32-h}r.rotl=s;function o(c,h){return c<<32-h|c>>>h}r.rotr=o;function u(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c}r.isInteger=Number.isInteger||u,r.MAX_SAFE_INTEGER=9007199254740991,r.isSafeInteger=function(c){return r.isInteger(c)&&c>=-r.MAX_SAFE_INTEGER&&c<=r.MAX_SAFE_INTEGER}})(Wn);Object.defineProperty(re,"__esModule",{value:!0});var Yn=Wn;function Mc(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])<<16>>16}re.readInt16BE=Mc;function $c(r,e){return e===void 0&&(e=0),(r[e+0]<<8|r[e+1])>>>0}re.readUint16BE=$c;function jc(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])<<16>>16}re.readInt16LE=jc;function zc(r,e){return e===void 0&&(e=0),(r[e+1]<<8|r[e])>>>0}re.readUint16LE=zc;function Jn(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>8,e[t+1]=r>>>0,e}re.writeUint16BE=Jn;re.writeInt16BE=Jn;function Xn(r,e,t){return e===void 0&&(e=new Uint8Array(2)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e}re.writeUint16LE=Xn;re.writeInt16LE=Xn;function xi(r,e){return e===void 0&&(e=0),r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}re.readInt32BE=xi;function Ii(r,e){return e===void 0&&(e=0),(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}re.readUint32BE=Ii;function Oi(r,e){return e===void 0&&(e=0),r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e]}re.readInt32LE=Oi;function Ai(r,e){return e===void 0&&(e=0),(r[e+3]<<24|r[e+2]<<16|r[e+1]<<8|r[e])>>>0}re.readUint32LE=Ai;function Vr(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>24,e[t+1]=r>>>16,e[t+2]=r>>>8,e[t+3]=r>>>0,e}re.writeUint32BE=Vr;re.writeInt32BE=Vr;function Gr(r,e,t){return e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0),e[t+0]=r>>>0,e[t+1]=r>>>8,e[t+2]=r>>>16,e[t+3]=r>>>24,e}re.writeUint32LE=Gr;re.writeInt32LE=Gr;function Hc(r,e){e===void 0&&(e=0);var t=xi(r,e),i=xi(r,e+4);return t*4294967296+i-(i>>31)*4294967296}re.readInt64BE=Hc;function qc(r,e){e===void 0&&(e=0);var t=Ii(r,e),i=Ii(r,e+4);return t*4294967296+i}re.readUint64BE=qc;function Bc(r,e){e===void 0&&(e=0);var t=Oi(r,e),i=Oi(r,e+4);return i*4294967296+t-(t>>31)*4294967296}re.readInt64LE=Bc;function Kc(r,e){e===void 0&&(e=0);var t=Ai(r,e),i=Ai(r,e+4);return i*4294967296+t}re.readUint64LE=Kc;function Zn(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Vr(r/4294967296>>>0,e,t),Vr(r>>>0,e,t+4),e}re.writeUint64BE=Zn;re.writeInt64BE=Zn;function Qn(r,e,t){return e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0),Gr(r>>>0,e,t),Gr(r/4294967296>>>0,e,t+4),e}re.writeUint64LE=Qn;re.writeInt64LE=Qn;function Vc(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,s=1,o=r/8+t-1;o>=t;o--)i+=e[o]*s,s*=256;return i}re.readUintBE=Vc;function Gc(r,e,t){if(t===void 0&&(t=0),r%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(r/8>e.length-t)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,s=1,o=t;o<t+r/8;o++)i+=e[o]*s,s*=256;return i}re.readUintLE=Gc;function kc(r,e,t,i){if(t===void 0&&(t=new Uint8Array(r/8)),i===void 0&&(i=0),r%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!Yn.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,o=r/8+i-1;o>=i;o--)t[o]=e/s&255,s*=256;return t}re.writeUintBE=kc;function Wc(r,e,t,i){if(t===void 0&&(t=new Uint8Array(r/8)),i===void 0&&(i=0),r%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!Yn.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,o=i;o<i+r/8;o++)t[o]=e/s&255,s*=256;return t}re.writeUintLE=Wc;function Yc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e)}re.readFloat32BE=Yc;function Jc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat32(e,!0)}re.readFloat32LE=Jc;function Xc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e)}re.readFloat64BE=Xc;function Zc(r,e){e===void 0&&(e=0);var t=new DataView(r.buffer,r.byteOffset,r.byteLength);return t.getFloat64(e,!0)}re.readFloat64LE=Zc;function Qc(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(t,r),e}re.writeFloat32BE=Qc;function eh(r,e,t){e===void 0&&(e=new Uint8Array(4)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(t,r,!0),e}re.writeFloat32LE=eh;function th(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(t,r),e}re.writeFloat64BE=th;function rh(r,e,t){e===void 0&&(e=new Uint8Array(8)),t===void 0&&(t=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(t,r,!0),e}re.writeFloat64LE=rh;(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.randomStringForEntropy=r.randomString=r.randomUint32=r.randomBytes=r.defaultRandomSource=void 0;const e=Qr,t=re,i=lt;r.defaultRandomSource=new e.SystemRandomSource;function s(w,m=r.defaultRandomSource){return m.randomBytes(w)}r.randomBytes=s;function o(w=r.defaultRandomSource){const m=s(4,w),E=(0,t.readUint32LE)(m);return(0,i.wipe)(m),E}r.randomUint32=o;const u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(w,m=u,E=r.defaultRandomSource){if(m.length<2)throw new Error("randomString charset is too short");if(m.length>256)throw new Error("randomString charset is too long");let C="";const v=m.length,x=256-256%v;for(;w>0;){const P=s(Math.ceil(w*256/x),E);for(let A=0;A<P.length&&w>0;A++){const L=P[A];L<x&&(C+=m.charAt(L%v),w--)}(0,i.wipe)(P)}return C}r.randomString=c;function h(w,m=u,E=r.defaultRandomSource){const C=Math.ceil(w/(Math.log(m.length)/Math.LN2));return c(C,m,E)}r.randomStringForEntropy=h})(nr);var ea={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=re,t=lt;r.DIGEST_LENGTH=64,r.BLOCK_SIZE=128;var i=function(){function c(){this.digestLength=r.DIGEST_LENGTH,this.blockSize=r.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},c.prototype.update=function(h,w){if(w===void 0&&(w=h.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var m=0;if(this._bytesHashed+=w,this._bufferLength>0){for(;this._bufferLength<r.BLOCK_SIZE&&w>0;)this._buffer[this._bufferLength++]=h[m++],w--;this._bufferLength===this.blockSize&&(o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(w>=this.blockSize&&(m=o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,h,m,w),w%=this.blockSize);w>0;)this._buffer[this._bufferLength++]=h[m++],w--;return this},c.prototype.finish=function(h){if(!this._finished){var w=this._bytesHashed,m=this._bufferLength,E=w/536870912|0,C=w<<3,v=w%128<112?128:256;this._buffer[m]=128;for(var x=m+1;x<v-8;x++)this._buffer[x]=0;e.writeUint32BE(E,this._buffer,v-8),e.writeUint32BE(C,this._buffer,v-4),o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,v),this._finished=!0}for(var x=0;x<this.digestLength/8;x++)e.writeUint32BE(this._stateHi[x],h,x*8),e.writeUint32BE(this._stateLo[x],h,x*8+4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._stateHi.set(h.stateHi),this._stateLo.set(h.stateLo),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){t.wipe(h.stateHi),t.wipe(h.stateLo),h.buffer&&t.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();r.SHA512=i;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function o(c,h,w,m,E,C,v){for(var x=w[0],P=w[1],A=w[2],L=w[3],l=w[4],b=w[5],f=w[6],g=w[7],p=m[0],n=m[1],d=m[2],R=m[3],j=m[4],Y=m[5],J=m[6],X=m[7],N,T,k,z,U,M,$,H;v>=128;){for(var ie=0;ie<16;ie++){var q=8*ie+C;c[ie]=e.readUint32BE(E,q),h[ie]=e.readUint32BE(E,q+4)}for(var ie=0;ie<80;ie++){var Q=x,W=P,oe=A,O=L,I=l,D=b,a=f,_=g,B=p,V=n,le=d,be=R,de=j,_e=Y,Fe=J,Ne=X;if(N=g,T=X,U=T&65535,M=T>>>16,$=N&65535,H=N>>>16,N=(l>>>14|j<<32-14)^(l>>>18|j<<32-18)^(j>>>41-32|l<<32-(41-32)),T=(j>>>14|l<<32-14)^(j>>>18|l<<32-18)^(l>>>41-32|j<<32-(41-32)),U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,N=l&b^~l&f,T=j&Y^~j&J,U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,N=s[ie*2],T=s[ie*2+1],U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,N=c[ie%16],T=h[ie%16],U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,M+=U>>>16,$+=M>>>16,H+=$>>>16,k=$&65535|H<<16,z=U&65535|M<<16,N=k,T=z,U=T&65535,M=T>>>16,$=N&65535,H=N>>>16,N=(x>>>28|p<<32-28)^(p>>>34-32|x<<32-(34-32))^(p>>>39-32|x<<32-(39-32)),T=(p>>>28|x<<32-28)^(x>>>34-32|p<<32-(34-32))^(x>>>39-32|p<<32-(39-32)),U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,N=x&P^x&A^P&A,T=p&n^p&d^n&d,U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,M+=U>>>16,$+=M>>>16,H+=$>>>16,_=$&65535|H<<16,Ne=U&65535|M<<16,N=O,T=be,U=T&65535,M=T>>>16,$=N&65535,H=N>>>16,N=k,T=z,U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,M+=U>>>16,$+=M>>>16,H+=$>>>16,O=$&65535|H<<16,be=U&65535|M<<16,P=Q,A=W,L=oe,l=O,b=I,f=D,g=a,x=_,n=B,d=V,R=le,j=be,Y=de,J=_e,X=Fe,p=Ne,ie%16===15)for(var q=0;q<16;q++)N=c[q],T=h[q],U=T&65535,M=T>>>16,$=N&65535,H=N>>>16,N=c[(q+9)%16],T=h[(q+9)%16],U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,k=c[(q+1)%16],z=h[(q+1)%16],N=(k>>>1|z<<32-1)^(k>>>8|z<<32-8)^k>>>7,T=(z>>>1|k<<32-1)^(z>>>8|k<<32-8)^(z>>>7|k<<32-7),U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,k=c[(q+14)%16],z=h[(q+14)%16],N=(k>>>19|z<<32-19)^(z>>>61-32|k<<32-(61-32))^k>>>6,T=(z>>>19|k<<32-19)^(k>>>61-32|z<<32-(61-32))^(z>>>6|k<<32-6),U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,M+=U>>>16,$+=M>>>16,H+=$>>>16,c[q]=$&65535|H<<16,h[q]=U&65535|M<<16}N=x,T=p,U=T&65535,M=T>>>16,$=N&65535,H=N>>>16,N=w[0],T=m[0],U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,M+=U>>>16,$+=M>>>16,H+=$>>>16,w[0]=x=$&65535|H<<16,m[0]=p=U&65535|M<<16,N=P,T=n,U=T&65535,M=T>>>16,$=N&65535,H=N>>>16,N=w[1],T=m[1],U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,M+=U>>>16,$+=M>>>16,H+=$>>>16,w[1]=P=$&65535|H<<16,m[1]=n=U&65535|M<<16,N=A,T=d,U=T&65535,M=T>>>16,$=N&65535,H=N>>>16,N=w[2],T=m[2],U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,M+=U>>>16,$+=M>>>16,H+=$>>>16,w[2]=A=$&65535|H<<16,m[2]=d=U&65535|M<<16,N=L,T=R,U=T&65535,M=T>>>16,$=N&65535,H=N>>>16,N=w[3],T=m[3],U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,M+=U>>>16,$+=M>>>16,H+=$>>>16,w[3]=L=$&65535|H<<16,m[3]=R=U&65535|M<<16,N=l,T=j,U=T&65535,M=T>>>16,$=N&65535,H=N>>>16,N=w[4],T=m[4],U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,M+=U>>>16,$+=M>>>16,H+=$>>>16,w[4]=l=$&65535|H<<16,m[4]=j=U&65535|M<<16,N=b,T=Y,U=T&65535,M=T>>>16,$=N&65535,H=N>>>16,N=w[5],T=m[5],U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,M+=U>>>16,$+=M>>>16,H+=$>>>16,w[5]=b=$&65535|H<<16,m[5]=Y=U&65535|M<<16,N=f,T=J,U=T&65535,M=T>>>16,$=N&65535,H=N>>>16,N=w[6],T=m[6],U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,M+=U>>>16,$+=M>>>16,H+=$>>>16,w[6]=f=$&65535|H<<16,m[6]=J=U&65535|M<<16,N=g,T=X,U=T&65535,M=T>>>16,$=N&65535,H=N>>>16,N=w[7],T=m[7],U+=T&65535,M+=T>>>16,$+=N&65535,H+=N>>>16,M+=U>>>16,$+=M>>>16,H+=$>>>16,w[7]=g=$&65535|H<<16,m[7]=X=U&65535|M<<16,C+=128,v-=128}return C}function u(c){var h=new i;h.update(c);var w=h.digest();return h.clean(),w}r.hash=u})(ea);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.convertSecretKeyToX25519=r.convertPublicKeyToX25519=r.verify=r.sign=r.extractPublicKeyFromSecretKey=r.generateKeyPair=r.generateKeyPairFromSeed=r.SEED_LENGTH=r.SECRET_KEY_LENGTH=r.PUBLIC_KEY_LENGTH=r.SIGNATURE_LENGTH=void 0;const e=nr,t=ea,i=lt;r.SIGNATURE_LENGTH=64,r.PUBLIC_KEY_LENGTH=32,r.SECRET_KEY_LENGTH=64,r.SEED_LENGTH=32;function s(O){const I=new Float64Array(16);if(O)for(let D=0;D<O.length;D++)I[D]=O[D];return I}const o=new Uint8Array(32);o[0]=9;const u=s(),c=s([1]),h=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),w=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),m=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),E=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),C=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function v(O,I){for(let D=0;D<16;D++)O[D]=I[D]|0}function x(O){let I=1;for(let D=0;D<16;D++){let a=O[D]+I+65535;I=Math.floor(a/65536),O[D]=a-I*65536}O[0]+=I-1+37*(I-1)}function P(O,I,D){const a=~(D-1);for(let _=0;_<16;_++){const B=a&(O[_]^I[_]);O[_]^=B,I[_]^=B}}function A(O,I){const D=s(),a=s();for(let _=0;_<16;_++)a[_]=I[_];x(a),x(a),x(a);for(let _=0;_<2;_++){D[0]=a[0]-65517;for(let V=1;V<15;V++)D[V]=a[V]-65535-(D[V-1]>>16&1),D[V-1]&=65535;D[15]=a[15]-32767-(D[14]>>16&1);const B=D[15]>>16&1;D[14]&=65535,P(a,D,1-B)}for(let _=0;_<16;_++)O[2*_]=a[_]&255,O[2*_+1]=a[_]>>8}function L(O,I){let D=0;for(let a=0;a<32;a++)D|=O[a]^I[a];return(1&D-1>>>8)-1}function l(O,I){const D=new Uint8Array(32),a=new Uint8Array(32);return A(D,O),A(a,I),L(D,a)}function b(O){const I=new Uint8Array(32);return A(I,O),I[0]&1}function f(O,I){for(let D=0;D<16;D++)O[D]=I[2*D]+(I[2*D+1]<<8);O[15]&=32767}function g(O,I,D){for(let a=0;a<16;a++)O[a]=I[a]+D[a]}function p(O,I,D){for(let a=0;a<16;a++)O[a]=I[a]-D[a]}function n(O,I,D){let a,_,B=0,V=0,le=0,be=0,de=0,_e=0,Fe=0,Ne=0,ye=0,ge=0,fe=0,he=0,ce=0,ae=0,ne=0,ee=0,ue=0,pe=0,te=0,me=0,we=0,ve=0,De=0,Ee=0,bt=0,_t=0,Nt=0,ht=0,zt=0,cr=0,Pr=0,Le=D[0],Ce=D[1],Me=D[2],$e=D[3],je=D[4],Pe=D[5],qe=D[6],Be=D[7],Ke=D[8],Ve=D[9],Ge=D[10],He=D[11],ze=D[12],Ae=D[13],ke=D[14],We=D[15];a=I[0],B+=a*Le,V+=a*Ce,le+=a*Me,be+=a*$e,de+=a*je,_e+=a*Pe,Fe+=a*qe,Ne+=a*Be,ye+=a*Ke,ge+=a*Ve,fe+=a*Ge,he+=a*He,ce+=a*ze,ae+=a*Ae,ne+=a*ke,ee+=a*We,a=I[1],V+=a*Le,le+=a*Ce,be+=a*Me,de+=a*$e,_e+=a*je,Fe+=a*Pe,Ne+=a*qe,ye+=a*Be,ge+=a*Ke,fe+=a*Ve,he+=a*Ge,ce+=a*He,ae+=a*ze,ne+=a*Ae,ee+=a*ke,ue+=a*We,a=I[2],le+=a*Le,be+=a*Ce,de+=a*Me,_e+=a*$e,Fe+=a*je,Ne+=a*Pe,ye+=a*qe,ge+=a*Be,fe+=a*Ke,he+=a*Ve,ce+=a*Ge,ae+=a*He,ne+=a*ze,ee+=a*Ae,ue+=a*ke,pe+=a*We,a=I[3],be+=a*Le,de+=a*Ce,_e+=a*Me,Fe+=a*$e,Ne+=a*je,ye+=a*Pe,ge+=a*qe,fe+=a*Be,he+=a*Ke,ce+=a*Ve,ae+=a*Ge,ne+=a*He,ee+=a*ze,ue+=a*Ae,pe+=a*ke,te+=a*We,a=I[4],de+=a*Le,_e+=a*Ce,Fe+=a*Me,Ne+=a*$e,ye+=a*je,ge+=a*Pe,fe+=a*qe,he+=a*Be,ce+=a*Ke,ae+=a*Ve,ne+=a*Ge,ee+=a*He,ue+=a*ze,pe+=a*Ae,te+=a*ke,me+=a*We,a=I[5],_e+=a*Le,Fe+=a*Ce,Ne+=a*Me,ye+=a*$e,ge+=a*je,fe+=a*Pe,he+=a*qe,ce+=a*Be,ae+=a*Ke,ne+=a*Ve,ee+=a*Ge,ue+=a*He,pe+=a*ze,te+=a*Ae,me+=a*ke,we+=a*We,a=I[6],Fe+=a*Le,Ne+=a*Ce,ye+=a*Me,ge+=a*$e,fe+=a*je,he+=a*Pe,ce+=a*qe,ae+=a*Be,ne+=a*Ke,ee+=a*Ve,ue+=a*Ge,pe+=a*He,te+=a*ze,me+=a*Ae,we+=a*ke,ve+=a*We,a=I[7],Ne+=a*Le,ye+=a*Ce,ge+=a*Me,fe+=a*$e,he+=a*je,ce+=a*Pe,ae+=a*qe,ne+=a*Be,ee+=a*Ke,ue+=a*Ve,pe+=a*Ge,te+=a*He,me+=a*ze,we+=a*Ae,ve+=a*ke,De+=a*We,a=I[8],ye+=a*Le,ge+=a*Ce,fe+=a*Me,he+=a*$e,ce+=a*je,ae+=a*Pe,ne+=a*qe,ee+=a*Be,ue+=a*Ke,pe+=a*Ve,te+=a*Ge,me+=a*He,we+=a*ze,ve+=a*Ae,De+=a*ke,Ee+=a*We,a=I[9],ge+=a*Le,fe+=a*Ce,he+=a*Me,ce+=a*$e,ae+=a*je,ne+=a*Pe,ee+=a*qe,ue+=a*Be,pe+=a*Ke,te+=a*Ve,me+=a*Ge,we+=a*He,ve+=a*ze,De+=a*Ae,Ee+=a*ke,bt+=a*We,a=I[10],fe+=a*Le,he+=a*Ce,ce+=a*Me,ae+=a*$e,ne+=a*je,ee+=a*Pe,ue+=a*qe,pe+=a*Be,te+=a*Ke,me+=a*Ve,we+=a*Ge,ve+=a*He,De+=a*ze,Ee+=a*Ae,bt+=a*ke,_t+=a*We,a=I[11],he+=a*Le,ce+=a*Ce,ae+=a*Me,ne+=a*$e,ee+=a*je,ue+=a*Pe,pe+=a*qe,te+=a*Be,me+=a*Ke,we+=a*Ve,ve+=a*Ge,De+=a*He,Ee+=a*ze,bt+=a*Ae,_t+=a*ke,Nt+=a*We,a=I[12],ce+=a*Le,ae+=a*Ce,ne+=a*Me,ee+=a*$e,ue+=a*je,pe+=a*Pe,te+=a*qe,me+=a*Be,we+=a*Ke,ve+=a*Ve,De+=a*Ge,Ee+=a*He,bt+=a*ze,_t+=a*Ae,Nt+=a*ke,ht+=a*We,a=I[13],ae+=a*Le,ne+=a*Ce,ee+=a*Me,ue+=a*$e,pe+=a*je,te+=a*Pe,me+=a*qe,we+=a*Be,ve+=a*Ke,De+=a*Ve,Ee+=a*Ge,bt+=a*He,_t+=a*ze,Nt+=a*Ae,ht+=a*ke,zt+=a*We,a=I[14],ne+=a*Le,ee+=a*Ce,ue+=a*Me,pe+=a*$e,te+=a*je,me+=a*Pe,we+=a*qe,ve+=a*Be,De+=a*Ke,Ee+=a*Ve,bt+=a*Ge,_t+=a*He,Nt+=a*ze,ht+=a*Ae,zt+=a*ke,cr+=a*We,a=I[15],ee+=a*Le,ue+=a*Ce,pe+=a*Me,te+=a*$e,me+=a*je,we+=a*Pe,ve+=a*qe,De+=a*Be,Ee+=a*Ke,bt+=a*Ve,_t+=a*Ge,Nt+=a*He,ht+=a*ze,zt+=a*Ae,cr+=a*ke,Pr+=a*We,B+=38*ue,V+=38*pe,le+=38*te,be+=38*me,de+=38*we,_e+=38*ve,Fe+=38*De,Ne+=38*Ee,ye+=38*bt,ge+=38*_t,fe+=38*Nt,he+=38*ht,ce+=38*zt,ae+=38*cr,ne+=38*Pr,_=1,a=B+_+65535,_=Math.floor(a/65536),B=a-_*65536,a=V+_+65535,_=Math.floor(a/65536),V=a-_*65536,a=le+_+65535,_=Math.floor(a/65536),le=a-_*65536,a=be+_+65535,_=Math.floor(a/65536),be=a-_*65536,a=de+_+65535,_=Math.floor(a/65536),de=a-_*65536,a=_e+_+65535,_=Math.floor(a/65536),_e=a-_*65536,a=Fe+_+65535,_=Math.floor(a/65536),Fe=a-_*65536,a=Ne+_+65535,_=Math.floor(a/65536),Ne=a-_*65536,a=ye+_+65535,_=Math.floor(a/65536),ye=a-_*65536,a=ge+_+65535,_=Math.floor(a/65536),ge=a-_*65536,a=fe+_+65535,_=Math.floor(a/65536),fe=a-_*65536,a=he+_+65535,_=Math.floor(a/65536),he=a-_*65536,a=ce+_+65535,_=Math.floor(a/65536),ce=a-_*65536,a=ae+_+65535,_=Math.floor(a/65536),ae=a-_*65536,a=ne+_+65535,_=Math.floor(a/65536),ne=a-_*65536,a=ee+_+65535,_=Math.floor(a/65536),ee=a-_*65536,B+=_-1+37*(_-1),_=1,a=B+_+65535,_=Math.floor(a/65536),B=a-_*65536,a=V+_+65535,_=Math.floor(a/65536),V=a-_*65536,a=le+_+65535,_=Math.floor(a/65536),le=a-_*65536,a=be+_+65535,_=Math.floor(a/65536),be=a-_*65536,a=de+_+65535,_=Math.floor(a/65536),de=a-_*65536,a=_e+_+65535,_=Math.floor(a/65536),_e=a-_*65536,a=Fe+_+65535,_=Math.floor(a/65536),Fe=a-_*65536,a=Ne+_+65535,_=Math.floor(a/65536),Ne=a-_*65536,a=ye+_+65535,_=Math.floor(a/65536),ye=a-_*65536,a=ge+_+65535,_=Math.floor(a/65536),ge=a-_*65536,a=fe+_+65535,_=Math.floor(a/65536),fe=a-_*65536,a=he+_+65535,_=Math.floor(a/65536),he=a-_*65536,a=ce+_+65535,_=Math.floor(a/65536),ce=a-_*65536,a=ae+_+65535,_=Math.floor(a/65536),ae=a-_*65536,a=ne+_+65535,_=Math.floor(a/65536),ne=a-_*65536,a=ee+_+65535,_=Math.floor(a/65536),ee=a-_*65536,B+=_-1+37*(_-1),O[0]=B,O[1]=V,O[2]=le,O[3]=be,O[4]=de,O[5]=_e,O[6]=Fe,O[7]=Ne,O[8]=ye,O[9]=ge,O[10]=fe,O[11]=he,O[12]=ce,O[13]=ae,O[14]=ne,O[15]=ee}function d(O,I){n(O,I,I)}function R(O,I){const D=s();let a;for(a=0;a<16;a++)D[a]=I[a];for(a=253;a>=0;a--)d(D,D),a!==2&&a!==4&&n(D,D,I);for(a=0;a<16;a++)O[a]=D[a]}function j(O,I){const D=s();let a;for(a=0;a<16;a++)D[a]=I[a];for(a=250;a>=0;a--)d(D,D),a!==1&&n(D,D,I);for(a=0;a<16;a++)O[a]=D[a]}function Y(O,I){const D=s(),a=s(),_=s(),B=s(),V=s(),le=s(),be=s(),de=s(),_e=s();p(D,O[1],O[0]),p(_e,I[1],I[0]),n(D,D,_e),g(a,O[0],O[1]),g(_e,I[0],I[1]),n(a,a,_e),n(_,O[3],I[3]),n(_,_,w),n(B,O[2],I[2]),g(B,B,B),p(V,a,D),p(le,B,_),g(be,B,_),g(de,a,D),n(O[0],V,le),n(O[1],de,be),n(O[2],be,le),n(O[3],V,de)}function J(O,I,D){for(let a=0;a<4;a++)P(O[a],I[a],D)}function X(O,I){const D=s(),a=s(),_=s();R(_,I[2]),n(D,I[0],_),n(a,I[1],_),A(O,a),O[31]^=b(D)<<7}function N(O,I,D){v(O[0],u),v(O[1],c),v(O[2],c),v(O[3],u);for(let a=255;a>=0;--a){const _=D[a/8|0]>>(a&7)&1;J(O,I,_),Y(I,O),Y(O,O),J(O,I,_)}}function T(O,I){const D=[s(),s(),s(),s()];v(D[0],m),v(D[1],E),v(D[2],c),n(D[3],m,E),N(O,D,I)}function k(O){if(O.length!==r.SEED_LENGTH)throw new Error(`ed25519: seed must be ${r.SEED_LENGTH} bytes`);const I=(0,t.hash)(O);I[0]&=248,I[31]&=127,I[31]|=64;const D=new Uint8Array(32),a=[s(),s(),s(),s()];T(a,I),X(D,a);const _=new Uint8Array(64);return _.set(O),_.set(D,32),{publicKey:D,secretKey:_}}r.generateKeyPairFromSeed=k;function z(O){const I=(0,e.randomBytes)(32,O),D=k(I);return(0,i.wipe)(I),D}r.generateKeyPair=z;function U(O){if(O.length!==r.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${r.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(O.subarray(32))}r.extractPublicKeyFromSecretKey=U;const M=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function $(O,I){let D,a,_,B;for(a=63;a>=32;--a){for(D=0,_=a-32,B=a-12;_<B;++_)I[_]+=D-16*I[a]*M[_-(a-32)],D=Math.floor((I[_]+128)/256),I[_]-=D*256;I[_]+=D,I[a]=0}for(D=0,_=0;_<32;_++)I[_]+=D-(I[31]>>4)*M[_],D=I[_]>>8,I[_]&=255;for(_=0;_<32;_++)I[_]-=D*M[_];for(a=0;a<32;a++)I[a+1]+=I[a]>>8,O[a]=I[a]&255}function H(O){const I=new Float64Array(64);for(let D=0;D<64;D++)I[D]=O[D];for(let D=0;D<64;D++)O[D]=0;$(O,I)}function ie(O,I){const D=new Float64Array(64),a=[s(),s(),s(),s()],_=(0,t.hash)(O.subarray(0,32));_[0]&=248,_[31]&=127,_[31]|=64;const B=new Uint8Array(64);B.set(_.subarray(32),32);const V=new t.SHA512;V.update(B.subarray(32)),V.update(I);const le=V.digest();V.clean(),H(le),T(a,le),X(B,a),V.reset(),V.update(B.subarray(0,32)),V.update(O.subarray(32)),V.update(I);const be=V.digest();H(be);for(let de=0;de<32;de++)D[de]=le[de];for(let de=0;de<32;de++)for(let _e=0;_e<32;_e++)D[de+_e]+=be[de]*_[_e];return $(B.subarray(32),D),B}r.sign=ie;function q(O,I){const D=s(),a=s(),_=s(),B=s(),V=s(),le=s(),be=s();return v(O[2],c),f(O[1],I),d(_,O[1]),n(B,_,h),p(_,_,O[2]),g(B,O[2],B),d(V,B),d(le,V),n(be,le,V),n(D,be,_),n(D,D,B),j(D,D),n(D,D,_),n(D,D,B),n(D,D,B),n(O[0],D,B),d(a,O[0]),n(a,a,B),l(a,_)&&n(O[0],O[0],C),d(a,O[0]),n(a,a,B),l(a,_)?-1:(b(O[0])===I[31]>>7&&p(O[0],u,O[0]),n(O[3],O[0],O[1]),0)}function Q(O,I,D){const a=new Uint8Array(32),_=[s(),s(),s(),s()],B=[s(),s(),s(),s()];if(D.length!==r.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${r.SIGNATURE_LENGTH} bytes`);if(q(B,O))return!1;const V=new t.SHA512;V.update(D.subarray(0,32)),V.update(O),V.update(I);const le=V.digest();return H(le),N(_,B,le),T(B,D.subarray(32)),Y(_,B),X(a,_),!L(D,a)}r.verify=Q;function W(O){let I=[s(),s(),s(),s()];if(q(I,O))throw new Error("Ed25519: invalid public key");let D=s(),a=s(),_=I[1];g(D,c,_),p(a,c,_),R(a,a),n(D,D,a);let B=new Uint8Array(32);return A(B,D),B}r.convertPublicKeyToX25519=W;function oe(O){const I=(0,t.hash)(O.subarray(0,32));I[0]&=248,I[31]&=127,I[31]|=64;const D=new Uint8Array(I.subarray(0,32));return(0,i.wipe)(I),D}r.convertSecretKeyToX25519=oe})(Ki);const ih="EdDSA",sh="JWT",ta=".",ra="base64url",nh="utf8",ah="utf8",oh=":",ch="did",hh="key",Hs="base58btc",uh="z",lh="K36",fh=32;function ia(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function Ti(r,e){e||(e=r.reduce((s,o)=>s+o.length,0));const t=ia(e);let i=0;for(const s of r)t.set(s,i),i+=s.length;return t}function dh(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var o=r.charAt(s),u=o.charCodeAt(0);if(t[u]!==255)throw new TypeError(o+" is ambiguous");t[u]=s}var c=r.length,h=r.charAt(0),w=Math.log(c)/Math.log(256),m=Math.log(256)/Math.log(c);function E(x){if(x instanceof Uint8Array||(ArrayBuffer.isView(x)?x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength):Array.isArray(x)&&(x=Uint8Array.from(x))),!(x instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(x.length===0)return"";for(var P=0,A=0,L=0,l=x.length;L!==l&&x[L]===0;)L++,P++;for(var b=(l-L)*m+1>>>0,f=new Uint8Array(b);L!==l;){for(var g=x[L],p=0,n=b-1;(g!==0||p<A)&&n!==-1;n--,p++)g+=256*f[n]>>>0,f[n]=g%c>>>0,g=g/c>>>0;if(g!==0)throw new Error("Non-zero carry");A=p,L++}for(var d=b-A;d!==b&&f[d]===0;)d++;for(var R=h.repeat(P);d<b;++d)R+=r.charAt(f[d]);return R}function C(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return new Uint8Array;var P=0;if(x[P]!==" "){for(var A=0,L=0;x[P]===h;)A++,P++;for(var l=(x.length-P)*w+1>>>0,b=new Uint8Array(l);x[P];){var f=t[x.charCodeAt(P)];if(f===255)return;for(var g=0,p=l-1;(f!==0||g<L)&&p!==-1;p--,g++)f+=c*b[p]>>>0,b[p]=f%256>>>0,f=f/256>>>0;if(f!==0)throw new Error("Non-zero carry");L=g,P++}if(x[P]!==" "){for(var n=l-L;n!==l&&b[n]===0;)n++;for(var d=new Uint8Array(A+(l-n)),R=A;n!==l;)d[R++]=b[n++];return d}}}function v(x){var P=C(x);if(P)return P;throw new Error(`Non-${e} character`)}return{encode:E,decodeUnsafe:C,decode:v}}var gh=dh,ph=gh;const yh=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},bh=r=>new TextEncoder().encode(r),mh=r=>new TextDecoder().decode(r);class wh{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class _h{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return sa(this,e)}}class Eh{constructor(e){this.decoders=e}or(e){return sa(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const sa=(r,e)=>new Eh({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class vh{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new wh(e,t,i),this.decoder=new _h(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ri=({name:r,prefix:e,encode:t,decode:i})=>new vh(r,e,t,i),Or=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=ph(t,e);return ri({prefix:r,name:e,encode:i,decode:o=>yh(s(o))})},Dh=(r,e,t,i)=>{const s={};for(let m=0;m<e.length;++m)s[e[m]]=m;let o=r.length;for(;r[o-1]==="=";)--o;const u=new Uint8Array(o*t/8|0);let c=0,h=0,w=0;for(let m=0;m<o;++m){const E=s[r[m]];if(E===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<t|E,c+=t,c>=8&&(c-=8,u[w++]=255&h>>c)}if(c>=t||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return u},Sh=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let o="",u=0,c=0;for(let h=0;h<r.length;++h)for(c=c<<8|r[h],u+=8;u>t;)u-=t,o+=e[s&c>>u];if(u&&(o+=e[s&c<<t-u]),i)for(;o.length*t&7;)o+="=";return o},Qe=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>ri({prefix:e,name:r,encode(s){return Sh(s,i,t)},decode(s){return Dh(s,i,t,r)}}),xh=ri({prefix:"\0",name:"identity",encode:r=>mh(r),decode:r=>bh(r)}),Ih=Object.freeze(Object.defineProperty({__proto__:null,identity:xh},Symbol.toStringTag,{value:"Module"})),Oh=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Ah=Object.freeze(Object.defineProperty({__proto__:null,base2:Oh},Symbol.toStringTag,{value:"Module"})),Th=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Nh=Object.freeze(Object.defineProperty({__proto__:null,base8:Th},Symbol.toStringTag,{value:"Module"})),Ch=Or({prefix:"9",name:"base10",alphabet:"0123456789"}),Ph=Object.freeze(Object.defineProperty({__proto__:null,base10:Ch},Symbol.toStringTag,{value:"Module"})),Rh=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Fh=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Uh=Object.freeze(Object.defineProperty({__proto__:null,base16:Rh,base16upper:Fh},Symbol.toStringTag,{value:"Module"})),Lh=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Mh=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$h=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),jh=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),zh=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Hh=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),qh=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Bh=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Kh=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Vh=Object.freeze(Object.defineProperty({__proto__:null,base32:Lh,base32hex:zh,base32hexpad:qh,base32hexpadupper:Bh,base32hexupper:Hh,base32pad:$h,base32padupper:jh,base32upper:Mh,base32z:Kh},Symbol.toStringTag,{value:"Module"})),Gh=Or({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),kh=Or({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Wh=Object.freeze(Object.defineProperty({__proto__:null,base36:Gh,base36upper:kh},Symbol.toStringTag,{value:"Module"})),Yh=Or({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Jh=Or({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Xh=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Yh,base58flickr:Jh},Symbol.toStringTag,{value:"Module"})),Zh=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Qh=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),eu=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),tu=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),ru=Object.freeze(Object.defineProperty({__proto__:null,base64:Zh,base64pad:Qh,base64url:eu,base64urlpad:tu},Symbol.toStringTag,{value:"Module"})),na=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),iu=na.reduce((r,e,t)=>(r[t]=e,r),[]),su=na.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function nu(r){return r.reduce((e,t)=>(e+=iu[t],e),"")}function au(r){const e=[];for(const t of r){const i=su[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const ou=ri({prefix:"🚀",name:"base256emoji",encode:nu,decode:au}),cu=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:ou},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const qs={...Ih,...Ah,...Nh,...Ph,...Uh,...Vh,...Wh,...Xh,...ru,...cu};function aa(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Bs=aa("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),mi=aa("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=ia(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),oa={utf8:Bs,"utf-8":Bs,hex:qs.base16,latin1:mi,ascii:mi,binary:mi,...qs};function ct(r,e="utf8"){const t=oa[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function at(r,e="utf8"){const t=oa[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}function kr(r){return ct(at(ji(r),nh),ra)}function ca(r){const e=at(lh,Hs),t=uh+ct(Ti([e,r]),Hs);return[ch,hh,t].join(oh)}function hu(r){return ct(r,ra)}function uu(r){return at([kr(r.header),kr(r.payload)].join(ta),ah)}function lu(r){return[kr(r.header),kr(r.payload),hu(r.signature)].join(ta)}function Ks(r=nr.randomBytes(fh)){return Ki.generateKeyPairFromSeed(r)}async function fu(r,e,t,i,s=Z.fromMiliseconds(Date.now())){const o={alg:ih,typ:sh},u=ca(i.publicKey),c=s+t,h={iss:u,sub:r,aud:e,iat:s,exp:c},w=uu({header:o,payload:h}),m=Ki.sign(i.secretKey,w);return lu({header:o,payload:h,signature:m})}var Vi={},ii={};Object.defineProperty(ii,"__esModule",{value:!0});var rt=re,Ni=lt,du=20;function gu(r,e,t){for(var i=1634760805,s=857760878,o=2036477234,u=1797285236,c=t[3]<<24|t[2]<<16|t[1]<<8|t[0],h=t[7]<<24|t[6]<<16|t[5]<<8|t[4],w=t[11]<<24|t[10]<<16|t[9]<<8|t[8],m=t[15]<<24|t[14]<<16|t[13]<<8|t[12],E=t[19]<<24|t[18]<<16|t[17]<<8|t[16],C=t[23]<<24|t[22]<<16|t[21]<<8|t[20],v=t[27]<<24|t[26]<<16|t[25]<<8|t[24],x=t[31]<<24|t[30]<<16|t[29]<<8|t[28],P=e[3]<<24|e[2]<<16|e[1]<<8|e[0],A=e[7]<<24|e[6]<<16|e[5]<<8|e[4],L=e[11]<<24|e[10]<<16|e[9]<<8|e[8],l=e[15]<<24|e[14]<<16|e[13]<<8|e[12],b=i,f=s,g=o,p=u,n=c,d=h,R=w,j=m,Y=E,J=C,X=v,N=x,T=P,k=A,z=L,U=l,M=0;M<du;M+=2)b=b+n|0,T^=b,T=T>>>32-16|T<<16,Y=Y+T|0,n^=Y,n=n>>>32-12|n<<12,f=f+d|0,k^=f,k=k>>>32-16|k<<16,J=J+k|0,d^=J,d=d>>>32-12|d<<12,g=g+R|0,z^=g,z=z>>>32-16|z<<16,X=X+z|0,R^=X,R=R>>>32-12|R<<12,p=p+j|0,U^=p,U=U>>>32-16|U<<16,N=N+U|0,j^=N,j=j>>>32-12|j<<12,g=g+R|0,z^=g,z=z>>>32-8|z<<8,X=X+z|0,R^=X,R=R>>>32-7|R<<7,p=p+j|0,U^=p,U=U>>>32-8|U<<8,N=N+U|0,j^=N,j=j>>>32-7|j<<7,f=f+d|0,k^=f,k=k>>>32-8|k<<8,J=J+k|0,d^=J,d=d>>>32-7|d<<7,b=b+n|0,T^=b,T=T>>>32-8|T<<8,Y=Y+T|0,n^=Y,n=n>>>32-7|n<<7,b=b+d|0,U^=b,U=U>>>32-16|U<<16,X=X+U|0,d^=X,d=d>>>32-12|d<<12,f=f+R|0,T^=f,T=T>>>32-16|T<<16,N=N+T|0,R^=N,R=R>>>32-12|R<<12,g=g+j|0,k^=g,k=k>>>32-16|k<<16,Y=Y+k|0,j^=Y,j=j>>>32-12|j<<12,p=p+n|0,z^=p,z=z>>>32-16|z<<16,J=J+z|0,n^=J,n=n>>>32-12|n<<12,g=g+j|0,k^=g,k=k>>>32-8|k<<8,Y=Y+k|0,j^=Y,j=j>>>32-7|j<<7,p=p+n|0,z^=p,z=z>>>32-8|z<<8,J=J+z|0,n^=J,n=n>>>32-7|n<<7,f=f+R|0,T^=f,T=T>>>32-8|T<<8,N=N+T|0,R^=N,R=R>>>32-7|R<<7,b=b+d|0,U^=b,U=U>>>32-8|U<<8,X=X+U|0,d^=X,d=d>>>32-7|d<<7;rt.writeUint32LE(b+i|0,r,0),rt.writeUint32LE(f+s|0,r,4),rt.writeUint32LE(g+o|0,r,8),rt.writeUint32LE(p+u|0,r,12),rt.writeUint32LE(n+c|0,r,16),rt.writeUint32LE(d+h|0,r,20),rt.writeUint32LE(R+w|0,r,24),rt.writeUint32LE(j+m|0,r,28),rt.writeUint32LE(Y+E|0,r,32),rt.writeUint32LE(J+C|0,r,36),rt.writeUint32LE(X+v|0,r,40),rt.writeUint32LE(N+x|0,r,44),rt.writeUint32LE(T+P|0,r,48),rt.writeUint32LE(k+A|0,r,52),rt.writeUint32LE(z+L|0,r,56),rt.writeUint32LE(U+l|0,r,60)}function ha(r,e,t,i,s){if(s===void 0&&(s=0),r.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<t.length)throw new Error("ChaCha: destination is shorter than source");var o,u;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");o=new Uint8Array(16),u=o.length-e.length,o.set(e,u)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");o=e,u=s}for(var c=new Uint8Array(64),h=0;h<t.length;h+=64){gu(c,o,r);for(var w=h;w<h+64&&w<t.length;w++)i[w]=t[w]^c[w-h];yu(o,0,u)}return Ni.wipe(c),s===0&&Ni.wipe(o),i}ii.streamXOR=ha;function pu(r,e,t,i){return i===void 0&&(i=0),Ni.wipe(t),ha(r,e,t,t,i)}ii.stream=pu;function yu(r,e,t){for(var i=1;t--;)i=i+(r[e]&255)|0,r[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var ua={},jt={};Object.defineProperty(jt,"__esModule",{value:!0});function bu(r,e,t){return~(r-1)&e|r-1&t}jt.select=bu;function mu(r,e){return(r|0)-(e|0)-1>>>31&1}jt.lessOrEqual=mu;function la(r,e){if(r.length!==e.length)return 0;for(var t=0,i=0;i<r.length;i++)t|=r[i]^e[i];return 1&t-1>>>8}jt.compare=la;function wu(r,e){return r.length===0||e.length===0?!1:la(r,e)!==0}jt.equal=wu;(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=jt,t=lt;r.DIGEST_LENGTH=16;var i=function(){function u(c){this.digestLength=r.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var h=c[0]|c[1]<<8;this._r[0]=h&8191;var w=c[2]|c[3]<<8;this._r[1]=(h>>>13|w<<3)&8191;var m=c[4]|c[5]<<8;this._r[2]=(w>>>10|m<<6)&7939;var E=c[6]|c[7]<<8;this._r[3]=(m>>>7|E<<9)&8191;var C=c[8]|c[9]<<8;this._r[4]=(E>>>4|C<<12)&255,this._r[5]=C>>>1&8190;var v=c[10]|c[11]<<8;this._r[6]=(C>>>14|v<<2)&8191;var x=c[12]|c[13]<<8;this._r[7]=(v>>>11|x<<5)&8065;var P=c[14]|c[15]<<8;this._r[8]=(x>>>8|P<<8)&8191,this._r[9]=P>>>5&127,this._pad[0]=c[16]|c[17]<<8,this._pad[1]=c[18]|c[19]<<8,this._pad[2]=c[20]|c[21]<<8,this._pad[3]=c[22]|c[23]<<8,this._pad[4]=c[24]|c[25]<<8,this._pad[5]=c[26]|c[27]<<8,this._pad[6]=c[28]|c[29]<<8,this._pad[7]=c[30]|c[31]<<8}return u.prototype._blocks=function(c,h,w){for(var m=this._fin?0:2048,E=this._h[0],C=this._h[1],v=this._h[2],x=this._h[3],P=this._h[4],A=this._h[5],L=this._h[6],l=this._h[7],b=this._h[8],f=this._h[9],g=this._r[0],p=this._r[1],n=this._r[2],d=this._r[3],R=this._r[4],j=this._r[5],Y=this._r[6],J=this._r[7],X=this._r[8],N=this._r[9];w>=16;){var T=c[h+0]|c[h+1]<<8;E+=T&8191;var k=c[h+2]|c[h+3]<<8;C+=(T>>>13|k<<3)&8191;var z=c[h+4]|c[h+5]<<8;v+=(k>>>10|z<<6)&8191;var U=c[h+6]|c[h+7]<<8;x+=(z>>>7|U<<9)&8191;var M=c[h+8]|c[h+9]<<8;P+=(U>>>4|M<<12)&8191,A+=M>>>1&8191;var $=c[h+10]|c[h+11]<<8;L+=(M>>>14|$<<2)&8191;var H=c[h+12]|c[h+13]<<8;l+=($>>>11|H<<5)&8191;var ie=c[h+14]|c[h+15]<<8;b+=(H>>>8|ie<<8)&8191,f+=ie>>>5|m;var q=0,Q=q;Q+=E*g,Q+=C*(5*N),Q+=v*(5*X),Q+=x*(5*J),Q+=P*(5*Y),q=Q>>>13,Q&=8191,Q+=A*(5*j),Q+=L*(5*R),Q+=l*(5*d),Q+=b*(5*n),Q+=f*(5*p),q+=Q>>>13,Q&=8191;var W=q;W+=E*p,W+=C*g,W+=v*(5*N),W+=x*(5*X),W+=P*(5*J),q=W>>>13,W&=8191,W+=A*(5*Y),W+=L*(5*j),W+=l*(5*R),W+=b*(5*d),W+=f*(5*n),q+=W>>>13,W&=8191;var oe=q;oe+=E*n,oe+=C*p,oe+=v*g,oe+=x*(5*N),oe+=P*(5*X),q=oe>>>13,oe&=8191,oe+=A*(5*J),oe+=L*(5*Y),oe+=l*(5*j),oe+=b*(5*R),oe+=f*(5*d),q+=oe>>>13,oe&=8191;var O=q;O+=E*d,O+=C*n,O+=v*p,O+=x*g,O+=P*(5*N),q=O>>>13,O&=8191,O+=A*(5*X),O+=L*(5*J),O+=l*(5*Y),O+=b*(5*j),O+=f*(5*R),q+=O>>>13,O&=8191;var I=q;I+=E*R,I+=C*d,I+=v*n,I+=x*p,I+=P*g,q=I>>>13,I&=8191,I+=A*(5*N),I+=L*(5*X),I+=l*(5*J),I+=b*(5*Y),I+=f*(5*j),q+=I>>>13,I&=8191;var D=q;D+=E*j,D+=C*R,D+=v*d,D+=x*n,D+=P*p,q=D>>>13,D&=8191,D+=A*g,D+=L*(5*N),D+=l*(5*X),D+=b*(5*J),D+=f*(5*Y),q+=D>>>13,D&=8191;var a=q;a+=E*Y,a+=C*j,a+=v*R,a+=x*d,a+=P*n,q=a>>>13,a&=8191,a+=A*p,a+=L*g,a+=l*(5*N),a+=b*(5*X),a+=f*(5*J),q+=a>>>13,a&=8191;var _=q;_+=E*J,_+=C*Y,_+=v*j,_+=x*R,_+=P*d,q=_>>>13,_&=8191,_+=A*n,_+=L*p,_+=l*g,_+=b*(5*N),_+=f*(5*X),q+=_>>>13,_&=8191;var B=q;B+=E*X,B+=C*J,B+=v*Y,B+=x*j,B+=P*R,q=B>>>13,B&=8191,B+=A*d,B+=L*n,B+=l*p,B+=b*g,B+=f*(5*N),q+=B>>>13,B&=8191;var V=q;V+=E*N,V+=C*X,V+=v*J,V+=x*Y,V+=P*j,q=V>>>13,V&=8191,V+=A*R,V+=L*d,V+=l*n,V+=b*p,V+=f*g,q+=V>>>13,V&=8191,q=(q<<2)+q|0,q=q+Q|0,Q=q&8191,q=q>>>13,W+=q,E=Q,C=W,v=oe,x=O,P=I,A=D,L=a,l=_,b=B,f=V,h+=16,w-=16}this._h[0]=E,this._h[1]=C,this._h[2]=v,this._h[3]=x,this._h[4]=P,this._h[5]=A,this._h[6]=L,this._h[7]=l,this._h[8]=b,this._h[9]=f},u.prototype.finish=function(c,h){h===void 0&&(h=0);var w=new Uint16Array(10),m,E,C,v;if(this._leftover){for(v=this._leftover,this._buffer[v++]=1;v<16;v++)this._buffer[v]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(m=this._h[1]>>>13,this._h[1]&=8191,v=2;v<10;v++)this._h[v]+=m,m=this._h[v]>>>13,this._h[v]&=8191;for(this._h[0]+=m*5,m=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=m,m=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=m,w[0]=this._h[0]+5,m=w[0]>>>13,w[0]&=8191,v=1;v<10;v++)w[v]=this._h[v]+m,m=w[v]>>>13,w[v]&=8191;for(w[9]-=1<<13,E=(m^1)-1,v=0;v<10;v++)w[v]&=E;for(E=~E,v=0;v<10;v++)this._h[v]=this._h[v]&E|w[v];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,C=this._h[0]+this._pad[0],this._h[0]=C&65535,v=1;v<8;v++)C=(this._h[v]+this._pad[v]|0)+(C>>>16)|0,this._h[v]=C&65535;return c[h+0]=this._h[0]>>>0,c[h+1]=this._h[0]>>>8,c[h+2]=this._h[1]>>>0,c[h+3]=this._h[1]>>>8,c[h+4]=this._h[2]>>>0,c[h+5]=this._h[2]>>>8,c[h+6]=this._h[3]>>>0,c[h+7]=this._h[3]>>>8,c[h+8]=this._h[4]>>>0,c[h+9]=this._h[4]>>>8,c[h+10]=this._h[5]>>>0,c[h+11]=this._h[5]>>>8,c[h+12]=this._h[6]>>>0,c[h+13]=this._h[6]>>>8,c[h+14]=this._h[7]>>>0,c[h+15]=this._h[7]>>>8,this._finished=!0,this},u.prototype.update=function(c){var h=0,w=c.length,m;if(this._leftover){m=16-this._leftover,m>w&&(m=w);for(var E=0;E<m;E++)this._buffer[this._leftover+E]=c[h+E];if(w-=m,h+=m,this._leftover+=m,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(w>=16&&(m=w-w%16,this._blocks(c,h,m),h+=m,w-=m),w){for(var E=0;E<w;E++)this._buffer[this._leftover+E]=c[h+E];this._leftover+=w}return this},u.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var c=new Uint8Array(16);return this.finish(c),c},u.prototype.clean=function(){return t.wipe(this._buffer),t.wipe(this._r),t.wipe(this._h),t.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},u}();r.Poly1305=i;function s(u,c){var h=new i(u);h.update(c);var w=h.digest();return h.clean(),w}r.oneTimeAuth=s;function o(u,c){return u.length!==r.DIGEST_LENGTH||c.length!==r.DIGEST_LENGTH?!1:e.equal(u,c)}r.equal=o})(ua);(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=ii,t=ua,i=lt,s=re,o=jt;r.KEY_LENGTH=32,r.NONCE_LENGTH=12,r.TAG_LENGTH=16;var u=new Uint8Array(16),c=function(){function h(w){if(this.nonceLength=r.NONCE_LENGTH,this.tagLength=r.TAG_LENGTH,w.length!==r.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(w)}return h.prototype.seal=function(w,m,E,C){if(w.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var v=new Uint8Array(16);v.set(w,v.length-w.length);var x=new Uint8Array(32);e.stream(this._key,v,x,4);var P=m.length+this.tagLength,A;if(C){if(C.length!==P)throw new Error("ChaCha20Poly1305: incorrect destination length");A=C}else A=new Uint8Array(P);return e.streamXOR(this._key,v,m,A,4),this._authenticate(A.subarray(A.length-this.tagLength,A.length),x,A.subarray(0,A.length-this.tagLength),E),i.wipe(v),A},h.prototype.open=function(w,m,E,C){if(w.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(m.length<this.tagLength)return null;var v=new Uint8Array(16);v.set(w,v.length-w.length);var x=new Uint8Array(32);e.stream(this._key,v,x,4);var P=new Uint8Array(this.tagLength);if(this._authenticate(P,x,m.subarray(0,m.length-this.tagLength),E),!o.equal(P,m.subarray(m.length-this.tagLength,m.length)))return null;var A=m.length-this.tagLength,L;if(C){if(C.length!==A)throw new Error("ChaCha20Poly1305: incorrect destination length");L=C}else L=new Uint8Array(A);return e.streamXOR(this._key,v,m.subarray(0,m.length-this.tagLength),L,4),i.wipe(v),L},h.prototype.clean=function(){return i.wipe(this._key),this},h.prototype._authenticate=function(w,m,E,C){var v=new t.Poly1305(m);C&&(v.update(C),C.length%16>0&&v.update(u.subarray(C.length%16))),v.update(E),E.length%16>0&&v.update(u.subarray(E.length%16));var x=new Uint8Array(8);C&&s.writeUint64LE(C.length,x),v.update(x),s.writeUint64LE(E.length,x),v.update(x);for(var P=v.digest(),A=0;A<P.length;A++)w[A]=P[A];v.clean(),i.wipe(P),i.wipe(x)},h}();r.ChaCha20Poly1305=c})(Vi);var fa={},Ar={},Gi={};Object.defineProperty(Gi,"__esModule",{value:!0});function _u(r){return typeof r.saveState<"u"&&typeof r.restoreState<"u"&&typeof r.cleanSavedState<"u"}Gi.isSerializableHash=_u;Object.defineProperty(Ar,"__esModule",{value:!0});var Et=Gi,Eu=jt,vu=lt,da=function(){function r(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(i).clean():i.set(t);for(var s=0;s<i.length;s++)i[s]^=54;this._inner.update(i);for(var s=0;s<i.length;s++)i[s]^=106;this._outer.update(i),Et.isSerializableHash(this._inner)&&Et.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),vu.wipe(i)}return r.prototype.reset=function(){if(!Et.isSerializableHash(this._inner)||!Et.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.clean=function(){Et.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),Et.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},r.prototype.update=function(e){return this._inner.update(e),this},r.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},r.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},r.prototype.saveState=function(){if(!Et.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},r.prototype.restoreState=function(e){if(!Et.isSerializableHash(this._inner)||!Et.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},r.prototype.cleanSavedState=function(e){if(!Et.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},r}();Ar.HMAC=da;function Du(r,e,t){var i=new da(r,e);i.update(t);var s=i.digest();return i.clean(),s}Ar.hmac=Du;Ar.equal=Eu.equal;Object.defineProperty(fa,"__esModule",{value:!0});var Vs=Ar,Gs=lt,Su=function(){function r(e,t,i,s){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var o=Vs.hmac(this._hash,i,t);this._hmac=new Vs.HMAC(e,o),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return r.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},r.prototype.expand=function(e){for(var t=new Uint8Array(e),i=0;i<t.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[i]=this._buffer[this._bufpos++];return t},r.prototype.clean=function(){this._hmac.clean(),Gs.wipe(this._buffer),Gs.wipe(this._counter),this._bufpos=0},r}(),xu=fa.HKDF=Su,si={};(function(r){Object.defineProperty(r,"__esModule",{value:!0});var e=re,t=lt;r.DIGEST_LENGTH=32,r.BLOCK_SIZE=64;var i=function(){function c(){this.digestLength=r.DIGEST_LENGTH,this.blockSize=r.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._temp),this.reset()},c.prototype.update=function(h,w){if(w===void 0&&(w=h.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var m=0;if(this._bytesHashed+=w,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&w>0;)this._buffer[this._bufferLength++]=h[m++],w--;this._bufferLength===this.blockSize&&(o(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(w>=this.blockSize&&(m=o(this._temp,this._state,h,m,w),w%=this.blockSize);w>0;)this._buffer[this._bufferLength++]=h[m++],w--;return this},c.prototype.finish=function(h){if(!this._finished){var w=this._bytesHashed,m=this._bufferLength,E=w/536870912|0,C=w<<3,v=w%64<56?64:128;this._buffer[m]=128;for(var x=m+1;x<v-8;x++)this._buffer[x]=0;e.writeUint32BE(E,this._buffer,v-8),e.writeUint32BE(C,this._buffer,v-4),o(this._temp,this._state,this._buffer,0,v),this._finished=!0}for(var x=0;x<this.digestLength/4;x++)e.writeUint32BE(this._state[x],h,x*4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._state.set(h.state),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){t.wipe(h.state),h.buffer&&t.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();r.SHA256=i;var s=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function o(c,h,w,m,E){for(;E>=64;){for(var C=h[0],v=h[1],x=h[2],P=h[3],A=h[4],L=h[5],l=h[6],b=h[7],f=0;f<16;f++){var g=m+f*4;c[f]=e.readUint32BE(w,g)}for(var f=16;f<64;f++){var p=c[f-2],n=(p>>>17|p<<32-17)^(p>>>19|p<<32-19)^p>>>10;p=c[f-15];var d=(p>>>7|p<<32-7)^(p>>>18|p<<32-18)^p>>>3;c[f]=(n+c[f-7]|0)+(d+c[f-16]|0)}for(var f=0;f<64;f++){var n=(((A>>>6|A<<26)^(A>>>11|A<<21)^(A>>>25|A<<7))+(A&L^~A&l)|0)+(b+(s[f]+c[f]|0)|0)|0,d=((C>>>2|C<<32-2)^(C>>>13|C<<32-13)^(C>>>22|C<<32-22))+(C&v^C&x^v&x)|0;b=l,l=L,L=A,A=P+n|0,P=x,x=v,v=C,C=n+d|0}h[0]+=C,h[1]+=v,h[2]+=x,h[3]+=P,h[4]+=A,h[5]+=L,h[6]+=l,h[7]+=b,m+=64,E-=64}return m}function u(c){var h=new i;h.update(c);var w=h.digest();return h.clean(),w}r.hash=u})(si);var ki={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.sharedKey=r.generateKeyPair=r.generateKeyPairFromSeed=r.scalarMultBase=r.scalarMult=r.SHARED_KEY_LENGTH=r.SECRET_KEY_LENGTH=r.PUBLIC_KEY_LENGTH=void 0;const e=nr,t=lt;r.PUBLIC_KEY_LENGTH=32,r.SECRET_KEY_LENGTH=32,r.SHARED_KEY_LENGTH=32;function i(f){const g=new Float64Array(16);if(f)for(let p=0;p<f.length;p++)g[p]=f[p];return g}const s=new Uint8Array(32);s[0]=9;const o=i([56129,1]);function u(f){let g=1;for(let p=0;p<16;p++){let n=f[p]+g+65535;g=Math.floor(n/65536),f[p]=n-g*65536}f[0]+=g-1+37*(g-1)}function c(f,g,p){const n=~(p-1);for(let d=0;d<16;d++){const R=n&(f[d]^g[d]);f[d]^=R,g[d]^=R}}function h(f,g){const p=i(),n=i();for(let d=0;d<16;d++)n[d]=g[d];u(n),u(n),u(n);for(let d=0;d<2;d++){p[0]=n[0]-65517;for(let j=1;j<15;j++)p[j]=n[j]-65535-(p[j-1]>>16&1),p[j-1]&=65535;p[15]=n[15]-32767-(p[14]>>16&1);const R=p[15]>>16&1;p[14]&=65535,c(n,p,1-R)}for(let d=0;d<16;d++)f[2*d]=n[d]&255,f[2*d+1]=n[d]>>8}function w(f,g){for(let p=0;p<16;p++)f[p]=g[2*p]+(g[2*p+1]<<8);f[15]&=32767}function m(f,g,p){for(let n=0;n<16;n++)f[n]=g[n]+p[n]}function E(f,g,p){for(let n=0;n<16;n++)f[n]=g[n]-p[n]}function C(f,g,p){let n,d,R=0,j=0,Y=0,J=0,X=0,N=0,T=0,k=0,z=0,U=0,M=0,$=0,H=0,ie=0,q=0,Q=0,W=0,oe=0,O=0,I=0,D=0,a=0,_=0,B=0,V=0,le=0,be=0,de=0,_e=0,Fe=0,Ne=0,ye=p[0],ge=p[1],fe=p[2],he=p[3],ce=p[4],ae=p[5],ne=p[6],ee=p[7],ue=p[8],pe=p[9],te=p[10],me=p[11],we=p[12],ve=p[13],De=p[14],Ee=p[15];n=g[0],R+=n*ye,j+=n*ge,Y+=n*fe,J+=n*he,X+=n*ce,N+=n*ae,T+=n*ne,k+=n*ee,z+=n*ue,U+=n*pe,M+=n*te,$+=n*me,H+=n*we,ie+=n*ve,q+=n*De,Q+=n*Ee,n=g[1],j+=n*ye,Y+=n*ge,J+=n*fe,X+=n*he,N+=n*ce,T+=n*ae,k+=n*ne,z+=n*ee,U+=n*ue,M+=n*pe,$+=n*te,H+=n*me,ie+=n*we,q+=n*ve,Q+=n*De,W+=n*Ee,n=g[2],Y+=n*ye,J+=n*ge,X+=n*fe,N+=n*he,T+=n*ce,k+=n*ae,z+=n*ne,U+=n*ee,M+=n*ue,$+=n*pe,H+=n*te,ie+=n*me,q+=n*we,Q+=n*ve,W+=n*De,oe+=n*Ee,n=g[3],J+=n*ye,X+=n*ge,N+=n*fe,T+=n*he,k+=n*ce,z+=n*ae,U+=n*ne,M+=n*ee,$+=n*ue,H+=n*pe,ie+=n*te,q+=n*me,Q+=n*we,W+=n*ve,oe+=n*De,O+=n*Ee,n=g[4],X+=n*ye,N+=n*ge,T+=n*fe,k+=n*he,z+=n*ce,U+=n*ae,M+=n*ne,$+=n*ee,H+=n*ue,ie+=n*pe,q+=n*te,Q+=n*me,W+=n*we,oe+=n*ve,O+=n*De,I+=n*Ee,n=g[5],N+=n*ye,T+=n*ge,k+=n*fe,z+=n*he,U+=n*ce,M+=n*ae,$+=n*ne,H+=n*ee,ie+=n*ue,q+=n*pe,Q+=n*te,W+=n*me,oe+=n*we,O+=n*ve,I+=n*De,D+=n*Ee,n=g[6],T+=n*ye,k+=n*ge,z+=n*fe,U+=n*he,M+=n*ce,$+=n*ae,H+=n*ne,ie+=n*ee,q+=n*ue,Q+=n*pe,W+=n*te,oe+=n*me,O+=n*we,I+=n*ve,D+=n*De,a+=n*Ee,n=g[7],k+=n*ye,z+=n*ge,U+=n*fe,M+=n*he,$+=n*ce,H+=n*ae,ie+=n*ne,q+=n*ee,Q+=n*ue,W+=n*pe,oe+=n*te,O+=n*me,I+=n*we,D+=n*ve,a+=n*De,_+=n*Ee,n=g[8],z+=n*ye,U+=n*ge,M+=n*fe,$+=n*he,H+=n*ce,ie+=n*ae,q+=n*ne,Q+=n*ee,W+=n*ue,oe+=n*pe,O+=n*te,I+=n*me,D+=n*we,a+=n*ve,_+=n*De,B+=n*Ee,n=g[9],U+=n*ye,M+=n*ge,$+=n*fe,H+=n*he,ie+=n*ce,q+=n*ae,Q+=n*ne,W+=n*ee,oe+=n*ue,O+=n*pe,I+=n*te,D+=n*me,a+=n*we,_+=n*ve,B+=n*De,V+=n*Ee,n=g[10],M+=n*ye,$+=n*ge,H+=n*fe,ie+=n*he,q+=n*ce,Q+=n*ae,W+=n*ne,oe+=n*ee,O+=n*ue,I+=n*pe,D+=n*te,a+=n*me,_+=n*we,B+=n*ve,V+=n*De,le+=n*Ee,n=g[11],$+=n*ye,H+=n*ge,ie+=n*fe,q+=n*he,Q+=n*ce,W+=n*ae,oe+=n*ne,O+=n*ee,I+=n*ue,D+=n*pe,a+=n*te,_+=n*me,B+=n*we,V+=n*ve,le+=n*De,be+=n*Ee,n=g[12],H+=n*ye,ie+=n*ge,q+=n*fe,Q+=n*he,W+=n*ce,oe+=n*ae,O+=n*ne,I+=n*ee,D+=n*ue,a+=n*pe,_+=n*te,B+=n*me,V+=n*we,le+=n*ve,be+=n*De,de+=n*Ee,n=g[13],ie+=n*ye,q+=n*ge,Q+=n*fe,W+=n*he,oe+=n*ce,O+=n*ae,I+=n*ne,D+=n*ee,a+=n*ue,_+=n*pe,B+=n*te,V+=n*me,le+=n*we,be+=n*ve,de+=n*De,_e+=n*Ee,n=g[14],q+=n*ye,Q+=n*ge,W+=n*fe,oe+=n*he,O+=n*ce,I+=n*ae,D+=n*ne,a+=n*ee,_+=n*ue,B+=n*pe,V+=n*te,le+=n*me,be+=n*we,de+=n*ve,_e+=n*De,Fe+=n*Ee,n=g[15],Q+=n*ye,W+=n*ge,oe+=n*fe,O+=n*he,I+=n*ce,D+=n*ae,a+=n*ne,_+=n*ee,B+=n*ue,V+=n*pe,le+=n*te,be+=n*me,de+=n*we,_e+=n*ve,Fe+=n*De,Ne+=n*Ee,R+=38*W,j+=38*oe,Y+=38*O,J+=38*I,X+=38*D,N+=38*a,T+=38*_,k+=38*B,z+=38*V,U+=38*le,M+=38*be,$+=38*de,H+=38*_e,ie+=38*Fe,q+=38*Ne,d=1,n=R+d+65535,d=Math.floor(n/65536),R=n-d*65536,n=j+d+65535,d=Math.floor(n/65536),j=n-d*65536,n=Y+d+65535,d=Math.floor(n/65536),Y=n-d*65536,n=J+d+65535,d=Math.floor(n/65536),J=n-d*65536,n=X+d+65535,d=Math.floor(n/65536),X=n-d*65536,n=N+d+65535,d=Math.floor(n/65536),N=n-d*65536,n=T+d+65535,d=Math.floor(n/65536),T=n-d*65536,n=k+d+65535,d=Math.floor(n/65536),k=n-d*65536,n=z+d+65535,d=Math.floor(n/65536),z=n-d*65536,n=U+d+65535,d=Math.floor(n/65536),U=n-d*65536,n=M+d+65535,d=Math.floor(n/65536),M=n-d*65536,n=$+d+65535,d=Math.floor(n/65536),$=n-d*65536,n=H+d+65535,d=Math.floor(n/65536),H=n-d*65536,n=ie+d+65535,d=Math.floor(n/65536),ie=n-d*65536,n=q+d+65535,d=Math.floor(n/65536),q=n-d*65536,n=Q+d+65535,d=Math.floor(n/65536),Q=n-d*65536,R+=d-1+37*(d-1),d=1,n=R+d+65535,d=Math.floor(n/65536),R=n-d*65536,n=j+d+65535,d=Math.floor(n/65536),j=n-d*65536,n=Y+d+65535,d=Math.floor(n/65536),Y=n-d*65536,n=J+d+65535,d=Math.floor(n/65536),J=n-d*65536,n=X+d+65535,d=Math.floor(n/65536),X=n-d*65536,n=N+d+65535,d=Math.floor(n/65536),N=n-d*65536,n=T+d+65535,d=Math.floor(n/65536),T=n-d*65536,n=k+d+65535,d=Math.floor(n/65536),k=n-d*65536,n=z+d+65535,d=Math.floor(n/65536),z=n-d*65536,n=U+d+65535,d=Math.floor(n/65536),U=n-d*65536,n=M+d+65535,d=Math.floor(n/65536),M=n-d*65536,n=$+d+65535,d=Math.floor(n/65536),$=n-d*65536,n=H+d+65535,d=Math.floor(n/65536),H=n-d*65536,n=ie+d+65535,d=Math.floor(n/65536),ie=n-d*65536,n=q+d+65535,d=Math.floor(n/65536),q=n-d*65536,n=Q+d+65535,d=Math.floor(n/65536),Q=n-d*65536,R+=d-1+37*(d-1),f[0]=R,f[1]=j,f[2]=Y,f[3]=J,f[4]=X,f[5]=N,f[6]=T,f[7]=k,f[8]=z,f[9]=U,f[10]=M,f[11]=$,f[12]=H,f[13]=ie,f[14]=q,f[15]=Q}function v(f,g){C(f,g,g)}function x(f,g){const p=i();for(let n=0;n<16;n++)p[n]=g[n];for(let n=253;n>=0;n--)v(p,p),n!==2&&n!==4&&C(p,p,g);for(let n=0;n<16;n++)f[n]=p[n]}function P(f,g){const p=new Uint8Array(32),n=new Float64Array(80),d=i(),R=i(),j=i(),Y=i(),J=i(),X=i();for(let z=0;z<31;z++)p[z]=f[z];p[31]=f[31]&127|64,p[0]&=248,w(n,g);for(let z=0;z<16;z++)R[z]=n[z];d[0]=Y[0]=1;for(let z=254;z>=0;--z){const U=p[z>>>3]>>>(z&7)&1;c(d,R,U),c(j,Y,U),m(J,d,j),E(d,d,j),m(j,R,Y),E(R,R,Y),v(Y,J),v(X,d),C(d,j,d),C(j,R,J),m(J,d,j),E(d,d,j),v(R,d),E(j,Y,X),C(d,j,o),m(d,d,Y),C(j,j,d),C(d,Y,X),C(Y,R,n),v(R,J),c(d,R,U),c(j,Y,U)}for(let z=0;z<16;z++)n[z+16]=d[z],n[z+32]=j[z],n[z+48]=R[z],n[z+64]=Y[z];const N=n.subarray(32),T=n.subarray(16);x(N,N),C(T,T,N);const k=new Uint8Array(32);return h(k,T),k}r.scalarMult=P;function A(f){return P(f,s)}r.scalarMultBase=A;function L(f){if(f.length!==r.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${r.SECRET_KEY_LENGTH} bytes`);const g=new Uint8Array(f);return{publicKey:A(g),secretKey:g}}r.generateKeyPairFromSeed=L;function l(f){const g=(0,e.randomBytes)(32,f),p=L(g);return(0,t.wipe)(g),p}r.generateKeyPair=l;function b(f,g,p=!1){if(f.length!==r.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(g.length!==r.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const n=P(f,g);if(p){let d=0;for(let R=0;R<n.length;R++)d|=n[R];if(d===0)throw new Error("X25519: invalid shared key")}return n}r.sharedKey=b})(ki);var ks=globalThis&&globalThis.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var i=0,s=e.length,o;i<s;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return r.concat(o||Array.prototype.slice.call(e))},Iu=function(){function r(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"}return r}(),Ou=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}(),Au=function(){function r(e,t,i,s){this.name=e,this.version=t,this.os=i,this.bot=s,this.type="bot-device"}return r}(),Tu=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),Nu=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),Cu=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Pu=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Ws=3,Ru=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Cu]],Ys=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Fu(r){return r?Js(r):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Nu:typeof navigator<"u"?Js(navigator.userAgent):Mu()}function Uu(r){return r!==""&&Ru.reduce(function(e,t){var i=t[0],s=t[1];if(e)return e;var o=s.exec(r);return!!o&&[i,o]},!1)}function Js(r){var e=Uu(r);if(!e)return null;var t=e[0],i=e[1];if(t==="searchbot")return new Tu;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<Ws&&(s=ks(ks([],s,!0),$u(Ws-s.length),!0)):s=[];var o=s.join("."),u=Lu(r),c=Pu.exec(r);return c&&c[1]?new Au(t,o,u,c[1]):new Iu(t,o,u)}function Lu(r){for(var e=0,t=Ys.length;e<t;e++){var i=Ys[e],s=i[0],o=i[1],u=o.exec(r);if(u)return s}return null}function Mu(){var r=typeof process<"u"&&process.version;return r?new Ou(process.version.slice(1)):null}function $u(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var xe={};Object.defineProperty(xe,"__esModule",{value:!0});xe.getLocalStorage=xe.getLocalStorageOrThrow=xe.getCrypto=xe.getCryptoOrThrow=pa=xe.getLocation=xe.getLocationOrThrow=Wi=xe.getNavigator=xe.getNavigatorOrThrow=ga=xe.getDocument=xe.getDocumentOrThrow=xe.getFromWindowOrThrow=xe.getFromWindow=void 0;function Xt(r){let e;return typeof window<"u"&&typeof window[r]<"u"&&(e=window[r]),e}xe.getFromWindow=Xt;function ar(r){const e=Xt(r);if(!e)throw new Error(`${r} is not defined in Window`);return e}xe.getFromWindowOrThrow=ar;function ju(){return ar("document")}xe.getDocumentOrThrow=ju;function zu(){return Xt("document")}var ga=xe.getDocument=zu;function Hu(){return ar("navigator")}xe.getNavigatorOrThrow=Hu;function qu(){return Xt("navigator")}var Wi=xe.getNavigator=qu;function Bu(){return ar("location")}xe.getLocationOrThrow=Bu;function Ku(){return Xt("location")}var pa=xe.getLocation=Ku;function Vu(){return ar("crypto")}xe.getCryptoOrThrow=Vu;function Gu(){return Xt("crypto")}xe.getCrypto=Gu;function ku(){return ar("localStorage")}xe.getLocalStorageOrThrow=ku;function Wu(){return Xt("localStorage")}xe.getLocalStorage=Wu;var Yi={};Object.defineProperty(Yi,"__esModule",{value:!0});var ya=Yi.getWindowMetadata=void 0;const Xs=xe;function Yu(){let r,e;try{r=Xs.getDocumentOrThrow(),e=Xs.getLocationOrThrow()}catch{return null}function t(){const E=r.getElementsByTagName("link"),C=[];for(let v=0;v<E.length;v++){const x=E[v],P=x.getAttribute("rel");if(P&&P.toLowerCase().indexOf("icon")>-1){const A=x.getAttribute("href");if(A)if(A.toLowerCase().indexOf("https:")===-1&&A.toLowerCase().indexOf("http:")===-1&&A.indexOf("//")!==0){let L=e.protocol+"//"+e.host;if(A.indexOf("/")===0)L+=A;else{const l=e.pathname.split("/");l.pop();const b=l.join("/");L+=b+"/"+A}C.push(L)}else if(A.indexOf("//")===0){const L=e.protocol+A;C.push(L)}else C.push(A)}}return C}function i(...E){const C=r.getElementsByTagName("meta");for(let v=0;v<C.length;v++){const x=C[v],P=["itemprop","property","name"].map(A=>x.getAttribute(A)).filter(A=>A?E.includes(A):!1);if(P.length&&P){const A=x.getAttribute("content");if(A)return A}}return""}function s(){let E=i("name","og:site_name","og:title","twitter:title");return E||(E=r.title),E}function o(){return i("description","og:description","twitter:description","keywords")}const u=s(),c=o(),h=e.origin,w=t();return{description:c,url:h,icons:w,name:u}}ya=Yi.getWindowMetadata=Yu;var vr={},ba=function(r,e){for(var t={},i=Object.keys(r),s=Array.isArray(e),o=0;o<i.length;o++){var u=i[o],c=r[u];(s?e.indexOf(u)!==-1:e(u,c,r))&&(t[u]=c)}return t};(function(r){const e=Mn,t=$n,i=Ln,s=ba,o=l=>l==null,u=Symbol("encodeFragmentIdentifier");function c(l){switch(l.arrayFormat){case"index":return b=>(f,g)=>{const p=f.length;return g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[m(b,l),"[",p,"]"].join("")]:[...f,[m(b,l),"[",m(p,l),"]=",m(g,l)].join("")]};case"bracket":return b=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[m(b,l),"[]"].join("")]:[...f,[m(b,l),"[]=",m(g,l)].join("")];case"colon-list-separator":return b=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[m(b,l),":list="].join("")]:[...f,[m(b,l),":list=",m(g,l)].join("")];case"comma":case"separator":case"bracket-separator":{const b=l.arrayFormat==="bracket-separator"?"[]=":"=";return f=>(g,p)=>p===void 0||l.skipNull&&p===null||l.skipEmptyString&&p===""?g:(p=p===null?"":p,g.length===0?[[m(f,l),b,m(p,l)].join("")]:[[g,m(p,l)].join(l.arrayFormatSeparator)])}default:return b=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,m(b,l)]:[...f,[m(b,l),"=",m(g,l)].join("")]}}function h(l){let b;switch(l.arrayFormat){case"index":return(f,g,p)=>{if(b=/\[(\d*)\]$/.exec(f),f=f.replace(/\[\d*\]$/,""),!b){p[f]=g;return}p[f]===void 0&&(p[f]={}),p[f][b[1]]=g};case"bracket":return(f,g,p)=>{if(b=/(\[\])$/.exec(f),f=f.replace(/\[\]$/,""),!b){p[f]=g;return}if(p[f]===void 0){p[f]=[g];return}p[f]=[].concat(p[f],g)};case"colon-list-separator":return(f,g,p)=>{if(b=/(:list)$/.exec(f),f=f.replace(/:list$/,""),!b){p[f]=g;return}if(p[f]===void 0){p[f]=[g];return}p[f]=[].concat(p[f],g)};case"comma":case"separator":return(f,g,p)=>{const n=typeof g=="string"&&g.includes(l.arrayFormatSeparator),d=typeof g=="string"&&!n&&E(g,l).includes(l.arrayFormatSeparator);g=d?E(g,l):g;const R=n||d?g.split(l.arrayFormatSeparator).map(j=>E(j,l)):g===null?g:E(g,l);p[f]=R};case"bracket-separator":return(f,g,p)=>{const n=/(\[\])$/.test(f);if(f=f.replace(/\[\]$/,""),!n){p[f]=g&&E(g,l);return}const d=g===null?[]:g.split(l.arrayFormatSeparator).map(R=>E(R,l));if(p[f]===void 0){p[f]=d;return}p[f]=[].concat(p[f],d)};default:return(f,g,p)=>{if(p[f]===void 0){p[f]=g;return}p[f]=[].concat(p[f],g)}}}function w(l){if(typeof l!="string"||l.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(l,b){return b.encode?b.strict?e(l):encodeURIComponent(l):l}function E(l,b){return b.decode?t(l):l}function C(l){return Array.isArray(l)?l.sort():typeof l=="object"?C(Object.keys(l)).sort((b,f)=>Number(b)-Number(f)).map(b=>l[b]):l}function v(l){const b=l.indexOf("#");return b!==-1&&(l=l.slice(0,b)),l}function x(l){let b="";const f=l.indexOf("#");return f!==-1&&(b=l.slice(f)),b}function P(l){l=v(l);const b=l.indexOf("?");return b===-1?"":l.slice(b+1)}function A(l,b){return b.parseNumbers&&!Number.isNaN(Number(l))&&typeof l=="string"&&l.trim()!==""?l=Number(l):b.parseBooleans&&l!==null&&(l.toLowerCase()==="true"||l.toLowerCase()==="false")&&(l=l.toLowerCase()==="true"),l}function L(l,b){b=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},b),w(b.arrayFormatSeparator);const f=h(b),g=Object.create(null);if(typeof l!="string"||(l=l.trim().replace(/^[?#&]/,""),!l))return g;for(const p of l.split("&")){if(p==="")continue;let[n,d]=i(b.decode?p.replace(/\+/g," "):p,"=");d=d===void 0?null:["comma","separator","bracket-separator"].includes(b.arrayFormat)?d:E(d,b),f(E(n,b),d,g)}for(const p of Object.keys(g)){const n=g[p];if(typeof n=="object"&&n!==null)for(const d of Object.keys(n))n[d]=A(n[d],b);else g[p]=A(n,b)}return b.sort===!1?g:(b.sort===!0?Object.keys(g).sort():Object.keys(g).sort(b.sort)).reduce((p,n)=>{const d=g[n];return Boolean(d)&&typeof d=="object"&&!Array.isArray(d)?p[n]=C(d):p[n]=d,p},Object.create(null))}r.extract=P,r.parse=L,r.stringify=(l,b)=>{if(!l)return"";b=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},b),w(b.arrayFormatSeparator);const f=d=>b.skipNull&&o(l[d])||b.skipEmptyString&&l[d]==="",g=c(b),p={};for(const d of Object.keys(l))f(d)||(p[d]=l[d]);const n=Object.keys(p);return b.sort!==!1&&n.sort(b.sort),n.map(d=>{const R=l[d];return R===void 0?"":R===null?m(d,b):Array.isArray(R)?R.length===0&&b.arrayFormat==="bracket-separator"?m(d,b)+"[]":R.reduce(g(d),[]).join("&"):m(d,b)+"="+m(R,b)}).filter(d=>d.length>0).join("&")},r.parseUrl=(l,b)=>{b=Object.assign({decode:!0},b);const[f,g]=i(l,"#");return Object.assign({url:f.split("?")[0]||"",query:L(P(l),b)},b&&b.parseFragmentIdentifier&&g?{fragmentIdentifier:E(g,b)}:{})},r.stringifyUrl=(l,b)=>{b=Object.assign({encode:!0,strict:!0,[u]:!0},b);const f=v(l.url).split("?")[0]||"",g=r.extract(l.url),p=r.parse(g,{sort:!1}),n=Object.assign(p,l.query);let d=r.stringify(n,b);d&&(d=`?${d}`);let R=x(l.url);return l.fragmentIdentifier&&(R=`#${b[u]?m(l.fragmentIdentifier,b):l.fragmentIdentifier}`),`${f}${d}${R}`},r.pick=(l,b,f)=>{f=Object.assign({parseFragmentIdentifier:!0,[u]:!1},f);const{url:g,query:p,fragmentIdentifier:n}=r.parseUrl(l,f);return r.stringifyUrl({url:g,query:s(p,b),fragmentIdentifier:n},f)},r.exclude=(l,b,f)=>{const g=Array.isArray(b)?p=>!b.includes(p):(p,n)=>!b(p,n);return r.pick(l,g,f)}})(vr);const Ju={waku:{publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"},irn:{publish:"irn_publish",subscribe:"irn_subscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe"},iridium:{publish:"iridium_publish",subscribe:"iridium_subscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe"}},ma="base10",ot="base16",Ci="base64pad",Ji="utf8",wa=0,Zt=1,Xu=0,Zs=1,Pi=12,Xi=32;function Zu(){const r=ki.generateKeyPair();return{privateKey:ct(r.secretKey,ot),publicKey:ct(r.publicKey,ot)}}function Ri(){const r=nr.randomBytes(Xi);return ct(r,ot)}function Qu(r,e){const t=ki.sharedKey(at(r,ot),at(e,ot)),i=new xu(si.SHA256,t).expand(Xi);return ct(i,ot)}function el(r){const e=si.hash(at(r,ot));return ct(e,ot)}function Fi(r){const e=si.hash(at(r,Ji));return ct(e,ot)}function tl(r){return at(`${r}`,ma)}function Tr(r){return Number(ct(r,ma))}function rl(r){const e=tl(typeof r.type<"u"?r.type:wa);if(Tr(e)===Zt&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof r.senderPublicKey<"u"?at(r.senderPublicKey,ot):void 0,i=typeof r.iv<"u"?at(r.iv,ot):nr.randomBytes(Pi),s=new Vi.ChaCha20Poly1305(at(r.symKey,ot)).seal(i,at(r.message,Ji));return sl({type:e,sealed:s,iv:i,senderPublicKey:t})}function il(r){const e=new Vi.ChaCha20Poly1305(at(r.symKey,ot)),{sealed:t,iv:i}=Zi(r.encoded),s=e.open(i,t);if(s===null)throw new Error("Failed to decrypt");return ct(s,Ji)}function sl(r){if(Tr(r.type)===Zt){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ct(Ti([r.type,r.senderPublicKey,r.iv,r.sealed]),Ci)}return ct(Ti([r.type,r.iv,r.sealed]),Ci)}function Zi(r){const e=at(r,Ci),t=e.slice(Xu,Zs),i=Zs;if(Tr(t)===Zt){const c=i+Xi,h=c+Pi,w=e.slice(i,c),m=e.slice(c,h),E=e.slice(h);return{type:t,sealed:E,iv:m,senderPublicKey:w}}const s=i+Pi,o=e.slice(i,s),u=e.slice(s);return{type:t,sealed:u,iv:o}}function nl(r,e){const t=Zi(r);return _a({type:Tr(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?ct(t.senderPublicKey,ot):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function _a(r){const e=(r==null?void 0:r.type)||wa;if(e===Zt){if(typeof(r==null?void 0:r.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(r==null?void 0:r.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r==null?void 0:r.senderPublicKey,receiverPublicKey:r==null?void 0:r.receiverPublicKey}}function Qs(r){return r.type===Zt&&typeof r.senderPublicKey=="string"&&typeof r.receiverPublicKey=="string"}var al=Object.defineProperty,en=Object.getOwnPropertySymbols,ol=Object.prototype.hasOwnProperty,cl=Object.prototype.propertyIsEnumerable,tn=(r,e,t)=>e in r?al(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,rn=(r,e)=>{for(var t in e||(e={}))ol.call(e,t)&&tn(r,t,e[t]);if(en)for(var t of en(e))cl.call(e,t)&&tn(r,t,e[t]);return r};const hl="ReactNative",wr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},ul="js";function Ea(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function ll(){return!ga()&&!!Wi()&&navigator.product===hl}function fl(){return!Ea()&&!!Wi()}function dl(){return ll()?wr.reactNative:Ea()?wr.node:fl()?wr.browser:wr.unknown}function gl(r,e){let t=vr.parse(r);return t=rn(rn({},t),e),r=vr.stringify(t),r}function pl(){return ya()||{name:"",description:"",url:"",icons:[""]}}function yl(){const r=Fu();if(r===null)return"unknown";const e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return r.type==="browser"?[e,r.name,r.version].join("-"):[e,r.version].join("-")}function bl(){var r;const e=dl();return e===wr.browser?[e,((r=pa())==null?void 0:r.host)||"unknown"].join(":"):e}function ml(r,e,t){const i=yl(),s=bl();return[[r,e].join("-"),[ul,t].join("-"),i,s].join("/")}function wl({protocol:r,version:e,relayUrl:t,sdkVersion:i,auth:s,projectId:o}){const u=t.split("?"),c=ml(r,e,i),h={auth:s,ua:c,projectId:o},w=gl(u[1]||"",h);return u[0]+"?"+w}function Lt(r,e){return r.filter(t=>e.includes(t)).length===r.length}function va(r){return Object.fromEntries(r.entries())}function Da(r){return new Map(Object.entries(r))}function St(r,e){return Z.fromMiliseconds((e||Date.now())+Z.toMiliseconds(r))}function Ut(r){return Z.fromMiliseconds(Date.now())>=Z.toMiliseconds(r)}function Wt(r){const e=Z.toMiliseconds(r||Z.FIVE_MINUTES);let t,i,s;return{resolve:o=>{s&&t&&(clearTimeout(s),t(o))},reject:o=>{s&&i&&(clearTimeout(s),i(o))},done:()=>new Promise((o,u)=>{s=setTimeout(u,e),t=o,i=u})}}function Sa(r,e){return new Promise(async(t,i)=>{const s=setTimeout(()=>i(),e),o=await r;clearTimeout(s),t(o)})}function xa(r,e){if(typeof e=="string"&&e.startsWith(`${r}:`))return e;if(r.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(r.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function _l(r){return xa("topic",r)}function El(r){return xa("id",r)}function Ia(r){const[e,t]=r.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")i.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))i.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return i}function Ue(r,e){return`${r}${e?`:${e}`:""}`}const vl="irn";function Ui(r){return(r==null?void 0:r.relay)||{protocol:vl}}function Li(r){const e=Ju[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}var Dl=Object.defineProperty,sn=Object.getOwnPropertySymbols,Sl=Object.prototype.hasOwnProperty,xl=Object.prototype.propertyIsEnumerable,nn=(r,e,t)=>e in r?Dl(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Il=(r,e)=>{for(var t in e||(e={}))Sl.call(e,t)&&nn(r,t,e[t]);if(sn)for(var t of sn(e))xl.call(e,t)&&nn(r,t,e[t]);return r};function Ol(r,e="-"){const t={},i="relay"+e;return Object.keys(r).forEach(s=>{if(s.startsWith(i)){const o=s.replace(i,""),u=r[s];t[o]=u}}),t}function Al(r){const e=r.indexOf(":"),t=r.indexOf("?")!==-1?r.indexOf("?"):void 0,i=r.substring(0,e),s=r.substring(e+1,t).split("@"),o=typeof t<"u"?r.substring(t):"",u=vr.parse(o);return{protocol:i,topic:s[0],version:parseInt(s[1],10),symKey:u.symKey,relay:Ol(u)}}function Tl(r,e="-"){const t="relay",i={};return Object.keys(r).forEach(s=>{const o=t+e+s;r[s]&&(i[o]=r[s])}),i}function Nl(r){return`${r.protocol}:${r.topic}@${r.version}?`+vr.stringify(Il({symKey:r.symKey},Tl(r.relay)))}function Nr(r){const e=[];return r.forEach(t=>{const[i,s]=t.split(":");e.push(`${i}:${s}`)}),e}function Cl(r){const e=[];return Object.values(r).forEach(t=>{e.push(...Nr(t.accounts))}),e}function Pl(r,e){const t=[];return Object.values(r).forEach(i=>{Nr(i.accounts).includes(e)&&t.push(...i.methods)}),t}function Rl(r,e){const t=[];return Object.values(r).forEach(i=>{Nr(i.accounts).includes(e)&&t.push(...i.events)}),t}function Fl(r,e){const t=Br(r,e);if(t)throw new Error(t.message);const i={};for(const[s,o]of Object.entries(r))i[s]={methods:o.methods,events:o.events,chains:o.accounts.map(u=>`${u.split(":")[0]}:${u.split(":")[1]}`)};return i}const Ul={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Ll={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function K(r,e){const{message:t,code:i}=Ll[r];return{message:e?`${t} ${e}`:t,code:i}}function Je(r,e){const{message:t,code:i}=Ul[r];return{message:e?`${t} ${e}`:t,code:i}}function ni(r,e){return Array.isArray(r)?typeof e<"u"&&r.length?r.every(e):!0:!1}function Wr(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function pt(r){return typeof r>"u"}function Ze(r,e){return e&&pt(r)?!0:typeof r=="string"&&Boolean(r.trim().length)}function Qi(r,e){return e&&pt(r)?!0:typeof r=="number"&&!isNaN(r)}function Ml(r,e){const{requiredNamespaces:t}=e,i=Object.keys(r.namespaces),s=Object.keys(t);let o=!0;return Lt(s,i)?(i.forEach(u=>{const{accounts:c,methods:h,events:w}=r.namespaces[u],m=Nr(c),E=t[u];(!Lt(E.chains,m)||!Lt(E.methods,h)||!Lt(E.events,w))&&(o=!1)}),o):!1}function es(r){return Ze(r,!1)&&r.includes(":")?r.split(":").length===2:!1}function $l(r){if(Ze(r,!1)&&r.includes(":")){const e=r.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&es(t)}}return!1}function jl(r){if(Ze(r,!1))try{return typeof new URL(r)<"u"}catch{return!1}return!1}function zl(r){var e;return(e=r==null?void 0:r.proposer)==null?void 0:e.publicKey}function Hl(r){return r==null?void 0:r.topic}function ql(r,e){let t=null;return Ze(r==null?void 0:r.publicKey,!1)||(t=K("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function an(r){let e=!0;return ni(r)?r.length&&(e=r.every(t=>Ze(t,!1))):e=!1,e}function Bl(r,e,t){let i=null;return ni(e)?e.forEach(s=>{i||(!es(s)||!s.includes(r))&&(i=Je("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):i=Je("UNSUPPORTED_CHAINS",`${t}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),i}function Kl(r,e){let t=null;return Object.entries(r).forEach(([i,s])=>{if(t)return;const o=Bl(i,s==null?void 0:s.chains,`${e} requiredNamespace`);o&&(t=o)}),t}function Vl(r,e){let t=null;return ni(r)?r.forEach(i=>{t||$l(i)||(t=Je("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):t=Je("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function Gl(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=Vl(i==null?void 0:i.accounts,`${e} namespace`);s&&(t=s)}),t}function kl(r,e){let t=null;return an(r==null?void 0:r.methods)?an(r==null?void 0:r.events)||(t=Je("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=Je("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function Oa(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;const s=kl(i,`${e}, namespace`);s&&(t=s)}),t}function Wl(r,e){let t=null;if(r&&Wr(r)){const i=Oa(r,e);i&&(t=i);const s=Kl(r,e);s&&(t=s)}else t=K("MISSING_OR_INVALID",`${e}, requiredNamespaces should be an object with data`);return t}function Br(r,e){let t=null;if(r&&Wr(r)){const i=Oa(r,e);i&&(t=i);const s=Gl(r,e);s&&(t=s)}else t=K("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function Aa(r){return Ze(r.protocol,!0)}function Yl(r,e){let t=!1;return e&&!r?t=!0:r&&ni(r)&&r.length&&r.forEach(i=>{t=Aa(i)}),t}function Jl(r){return typeof r=="number"}function nt(r){return typeof r<"u"&&typeof r!==null}function Xl(r){return!(!r||typeof r!="object"||!r.code||!Qi(r.code,!1)||!r.message||!Ze(r.message,!1))}function Zl(r){return!(pt(r)||!Ze(r.method,!1))}function Ql(r){return!(pt(r)||pt(r.result)&&pt(r.error)||!Qi(r.id,!1)||!Ze(r.jsonrpc,!1))}function ef(r){return!(pt(r)||!Ze(r.name,!1))}function on(r,e){return!(!es(e)||!Cl(r).includes(e))}function tf(r,e,t){return Ze(t,!1)?Pl(r,e).includes(t):!1}function rf(r,e,t){return Ze(t,!1)?Rl(r,e).includes(t):!1}function cn(r,e,t){let i=null;const s=Object.keys(r),o=Object.keys(e);return Lt(s,o)?s.forEach(u=>{if(i)return;const c=r[u].chains,h=Nr(e[u].accounts);Lt(c,h)?Lt(r[u].methods,e[u].methods)?Lt(r[u].events,e[u].events)||(i=K("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy requiredNamespaces events for ${u}`)):i=K("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy requiredNamespaces methods for ${u}`):i=K("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy requiredNamespaces chains for ${u}`)}):i=K("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces`),i}function sf(r,e){return Qi(r,!1)&&r<=e.max&&r>=e.min}const hn=10,nf=()=>typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),af=()=>typeof window<"u",of=nf();class cf{constructor(e){if(this.url=e,this.events=new yt.EventEmitter,this.registering=!1,!bs(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(typeof this.socket>"u")throw new Error("Connection already closed");this.socket.close(),this.onClose()}async send(e,t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(ji(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!bs(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,s)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),s(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,i)=>{const s=Fo.isReactNative()?void 0:{rejectUnauthorized:!Uo(e)},o=new of(e,[],s);af()?o.onerror=u=>{const c=u;i(this.emitError(c.error))}:o.on("error",u=>{i(this.emitError(u))}),o.onopen=()=>{this.onOpen(o),t(o)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=()=>this.onClose(),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?jn(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const i=this.parseError(t),s=i.message||i.toString(),o=zi(e,s);this.events.emit("payload",o)}parseError(e,t=this.url){return Lo(e,t,"WS")}resetMaxListeners(){this.events.getMaxListeners()>hn&&this.events.setMaxListeners(hn)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",t),t}}var Yr={},hf={get exports(){return Yr},set exports(r){Yr=r}};(function(r,e){var t=200,i="__lodash_hash_undefined__",s=1,o=2,u=9007199254740991,c="[object Arguments]",h="[object Array]",w="[object AsyncFunction]",m="[object Boolean]",E="[object Date]",C="[object Error]",v="[object Function]",x="[object GeneratorFunction]",P="[object Map]",A="[object Number]",L="[object Null]",l="[object Object]",b="[object Promise]",f="[object Proxy]",g="[object RegExp]",p="[object Set]",n="[object String]",d="[object Symbol]",R="[object Undefined]",j="[object WeakMap]",Y="[object ArrayBuffer]",J="[object DataView]",X="[object Float32Array]",N="[object Float64Array]",T="[object Int8Array]",k="[object Int16Array]",z="[object Int32Array]",U="[object Uint8Array]",M="[object Uint8ClampedArray]",$="[object Uint16Array]",H="[object Uint32Array]",ie=/[\\^$.*+?()[\]{}|]/g,q=/^\[object .+?Constructor\]$/,Q=/^(?:0|[1-9]\d*)$/,W={};W[X]=W[N]=W[T]=W[k]=W[z]=W[U]=W[M]=W[$]=W[H]=!0,W[c]=W[h]=W[Y]=W[m]=W[J]=W[E]=W[C]=W[v]=W[P]=W[A]=W[l]=W[g]=W[p]=W[n]=W[j]=!1;var oe=typeof Yt=="object"&&Yt&&Yt.Object===Object&&Yt,O=typeof self=="object"&&self&&self.Object===Object&&self,I=oe||O||Function("return this")(),D=e&&!e.nodeType&&e,a=D&&!0&&r&&!r.nodeType&&r,_=a&&a.exports===D,B=_&&oe.process,V=function(){try{return B&&B.binding&&B.binding("util")}catch{}}(),le=V&&V.isTypedArray;function be(y,S){for(var F=-1,G=y==null?0:y.length,Oe=0,se=[];++F<G;){var Re=y[F];S(Re,F,y)&&(se[Oe++]=Re)}return se}function de(y,S){for(var F=-1,G=S.length,Oe=y.length;++F<G;)y[Oe+F]=S[F];return y}function _e(y,S){for(var F=-1,G=y==null?0:y.length;++F<G;)if(S(y[F],F,y))return!0;return!1}function Fe(y,S){for(var F=-1,G=Array(y);++F<y;)G[F]=S(F);return G}function Ne(y){return function(S){return y(S)}}function ye(y,S){return y.has(S)}function ge(y,S){return y==null?void 0:y[S]}function fe(y){var S=-1,F=Array(y.size);return y.forEach(function(G,Oe){F[++S]=[Oe,G]}),F}function he(y,S){return function(F){return y(S(F))}}function ce(y){var S=-1,F=Array(y.size);return y.forEach(function(G){F[++S]=G}),F}var ae=Array.prototype,ne=Function.prototype,ee=Object.prototype,ue=I["__core-js_shared__"],pe=ne.toString,te=ee.hasOwnProperty,me=function(){var y=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""}(),we=ee.toString,ve=RegExp("^"+pe.call(te).replace(ie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=_?I.Buffer:void 0,Ee=I.Symbol,bt=I.Uint8Array,_t=ee.propertyIsEnumerable,Nt=ae.splice,ht=Ee?Ee.toStringTag:void 0,zt=Object.getOwnPropertySymbols,cr=De?De.isBuffer:void 0,Pr=he(Object.keys,Object),Le=er(I,"DataView"),Ce=er(I,"Map"),Me=er(I,"Promise"),$e=er(I,"Set"),je=er(I,"WeakMap"),Pe=er(Object,"create"),qe=qt(Le),Be=qt(Ce),Ke=qt(Me),Ve=qt($e),Ge=qt(je),He=Ee?Ee.prototype:void 0,ze=He?He.valueOf:void 0;function Ae(y){var S=-1,F=y==null?0:y.length;for(this.clear();++S<F;){var G=y[S];this.set(G[0],G[1])}}function ke(){this.__data__=Pe?Pe(null):{},this.size=0}function We(y){var S=this.has(y)&&delete this.__data__[y];return this.size-=S?1:0,S}function Ka(y){var S=this.__data__;if(Pe){var F=S[y];return F===i?void 0:F}return te.call(S,y)?S[y]:void 0}function Va(y){var S=this.__data__;return Pe?S[y]!==void 0:te.call(S,y)}function Ga(y,S){var F=this.__data__;return this.size+=this.has(y)?0:1,F[y]=Pe&&S===void 0?i:S,this}Ae.prototype.clear=ke,Ae.prototype.delete=We,Ae.prototype.get=Ka,Ae.prototype.has=Va,Ae.prototype.set=Ga;function It(y){var S=-1,F=y==null?0:y.length;for(this.clear();++S<F;){var G=y[S];this.set(G[0],G[1])}}function ka(){this.__data__=[],this.size=0}function Wa(y){var S=this.__data__,F=Fr(S,y);if(F<0)return!1;var G=S.length-1;return F==G?S.pop():Nt.call(S,F,1),--this.size,!0}function Ya(y){var S=this.__data__,F=Fr(S,y);return F<0?void 0:S[F][1]}function Ja(y){return Fr(this.__data__,y)>-1}function Xa(y,S){var F=this.__data__,G=Fr(F,y);return G<0?(++this.size,F.push([y,S])):F[G][1]=S,this}It.prototype.clear=ka,It.prototype.delete=Wa,It.prototype.get=Ya,It.prototype.has=Ja,It.prototype.set=Xa;function Ht(y){var S=-1,F=y==null?0:y.length;for(this.clear();++S<F;){var G=y[S];this.set(G[0],G[1])}}function Za(){this.size=0,this.__data__={hash:new Ae,map:new(Ce||It),string:new Ae}}function Qa(y){var S=Ur(this,y).delete(y);return this.size-=S?1:0,S}function eo(y){return Ur(this,y).get(y)}function to(y){return Ur(this,y).has(y)}function ro(y,S){var F=Ur(this,y),G=F.size;return F.set(y,S),this.size+=F.size==G?0:1,this}Ht.prototype.clear=Za,Ht.prototype.delete=Qa,Ht.prototype.get=eo,Ht.prototype.has=to,Ht.prototype.set=ro;function Rr(y){var S=-1,F=y==null?0:y.length;for(this.__data__=new Ht;++S<F;)this.add(y[S])}function io(y){return this.__data__.set(y,i),this}function so(y){return this.__data__.has(y)}Rr.prototype.add=Rr.prototype.push=io,Rr.prototype.has=so;function Ct(y){var S=this.__data__=new It(y);this.size=S.size}function no(){this.__data__=new It,this.size=0}function ao(y){var S=this.__data__,F=S.delete(y);return this.size=S.size,F}function oo(y){return this.__data__.get(y)}function co(y){return this.__data__.has(y)}function ho(y,S){var F=this.__data__;if(F instanceof It){var G=F.__data__;if(!Ce||G.length<t-1)return G.push([y,S]),this.size=++F.size,this;F=this.__data__=new Ht(G)}return F.set(y,S),this.size=F.size,this}Ct.prototype.clear=no,Ct.prototype.delete=ao,Ct.prototype.get=oo,Ct.prototype.has=co,Ct.prototype.set=ho;function uo(y,S){var F=Lr(y),G=!F&&Io(y),Oe=!F&&!G&&ci(y),se=!F&&!G&&!Oe&&ps(y),Re=F||G||Oe||se,Ye=Re?Fe(y.length,String):[],Xe=Ye.length;for(var Te in y)(S||te.call(y,Te))&&!(Re&&(Te=="length"||Oe&&(Te=="offset"||Te=="parent")||se&&(Te=="buffer"||Te=="byteLength"||Te=="byteOffset")||Eo(Te,Xe)))&&Ye.push(Te);return Ye}function Fr(y,S){for(var F=y.length;F--;)if(ls(y[F][0],S))return F;return-1}function lo(y,S,F){var G=S(y);return Lr(y)?G:de(G,F(y))}function hr(y){return y==null?y===void 0?R:L:ht&&ht in Object(y)?wo(y):xo(y)}function os(y){return ur(y)&&hr(y)==c}function cs(y,S,F,G,Oe){return y===S?!0:y==null||S==null||!ur(y)&&!ur(S)?y!==y&&S!==S:fo(y,S,F,G,cs,Oe)}function fo(y,S,F,G,Oe,se){var Re=Lr(y),Ye=Lr(S),Xe=Re?h:Pt(y),Te=Ye?h:Pt(S);Xe=Xe==c?l:Xe,Te=Te==c?l:Te;var ut=Xe==l,mt=Te==l,tt=Xe==Te;if(tt&&ci(y)){if(!ci(S))return!1;Re=!0,ut=!1}if(tt&&!ut)return se||(se=new Ct),Re||ps(y)?hs(y,S,F,G,Oe,se):bo(y,S,Xe,F,G,Oe,se);if(!(F&s)){var ft=ut&&te.call(y,"__wrapped__"),dt=mt&&te.call(S,"__wrapped__");if(ft||dt){var Rt=ft?y.value():y,Ot=dt?S.value():S;return se||(se=new Ct),Oe(Rt,Ot,F,G,se)}}return tt?(se||(se=new Ct),mo(y,S,F,G,Oe,se)):!1}function go(y){if(!gs(y)||Do(y))return!1;var S=fs(y)?ve:q;return S.test(qt(y))}function po(y){return ur(y)&&ds(y.length)&&!!W[hr(y)]}function yo(y){if(!So(y))return Pr(y);var S=[];for(var F in Object(y))te.call(y,F)&&F!="constructor"&&S.push(F);return S}function hs(y,S,F,G,Oe,se){var Re=F&s,Ye=y.length,Xe=S.length;if(Ye!=Xe&&!(Re&&Xe>Ye))return!1;var Te=se.get(y);if(Te&&se.get(S))return Te==S;var ut=-1,mt=!0,tt=F&o?new Rr:void 0;for(se.set(y,S),se.set(S,y);++ut<Ye;){var ft=y[ut],dt=S[ut];if(G)var Rt=Re?G(dt,ft,ut,S,y,se):G(ft,dt,ut,y,S,se);if(Rt!==void 0){if(Rt)continue;mt=!1;break}if(tt){if(!_e(S,function(Ot,Bt){if(!ye(tt,Bt)&&(ft===Ot||Oe(ft,Ot,F,G,se)))return tt.push(Bt)})){mt=!1;break}}else if(!(ft===dt||Oe(ft,dt,F,G,se))){mt=!1;break}}return se.delete(y),se.delete(S),mt}function bo(y,S,F,G,Oe,se,Re){switch(F){case J:if(y.byteLength!=S.byteLength||y.byteOffset!=S.byteOffset)return!1;y=y.buffer,S=S.buffer;case Y:return!(y.byteLength!=S.byteLength||!se(new bt(y),new bt(S)));case m:case E:case A:return ls(+y,+S);case C:return y.name==S.name&&y.message==S.message;case g:case n:return y==S+"";case P:var Ye=fe;case p:var Xe=G&s;if(Ye||(Ye=ce),y.size!=S.size&&!Xe)return!1;var Te=Re.get(y);if(Te)return Te==S;G|=o,Re.set(y,S);var ut=hs(Ye(y),Ye(S),G,Oe,se,Re);return Re.delete(y),ut;case d:if(ze)return ze.call(y)==ze.call(S)}return!1}function mo(y,S,F,G,Oe,se){var Re=F&s,Ye=us(y),Xe=Ye.length,Te=us(S),ut=Te.length;if(Xe!=ut&&!Re)return!1;for(var mt=Xe;mt--;){var tt=Ye[mt];if(!(Re?tt in S:te.call(S,tt)))return!1}var ft=se.get(y);if(ft&&se.get(S))return ft==S;var dt=!0;se.set(y,S),se.set(S,y);for(var Rt=Re;++mt<Xe;){tt=Ye[mt];var Ot=y[tt],Bt=S[tt];if(G)var ys=Re?G(Bt,Ot,tt,S,y,se):G(Ot,Bt,tt,y,S,se);if(!(ys===void 0?Ot===Bt||Oe(Ot,Bt,F,G,se):ys)){dt=!1;break}Rt||(Rt=tt=="constructor")}if(dt&&!Rt){var Mr=y.constructor,$r=S.constructor;Mr!=$r&&"constructor"in y&&"constructor"in S&&!(typeof Mr=="function"&&Mr instanceof Mr&&typeof $r=="function"&&$r instanceof $r)&&(dt=!1)}return se.delete(y),se.delete(S),dt}function us(y){return lo(y,To,_o)}function Ur(y,S){var F=y.__data__;return vo(S)?F[typeof S=="string"?"string":"hash"]:F.map}function er(y,S){var F=ge(y,S);return go(F)?F:void 0}function wo(y){var S=te.call(y,ht),F=y[ht];try{y[ht]=void 0;var G=!0}catch{}var Oe=we.call(y);return G&&(S?y[ht]=F:delete y[ht]),Oe}var _o=zt?function(y){return y==null?[]:(y=Object(y),be(zt(y),function(S){return _t.call(y,S)}))}:No,Pt=hr;(Le&&Pt(new Le(new ArrayBuffer(1)))!=J||Ce&&Pt(new Ce)!=P||Me&&Pt(Me.resolve())!=b||$e&&Pt(new $e)!=p||je&&Pt(new je)!=j)&&(Pt=function(y){var S=hr(y),F=S==l?y.constructor:void 0,G=F?qt(F):"";if(G)switch(G){case qe:return J;case Be:return P;case Ke:return b;case Ve:return p;case Ge:return j}return S});function Eo(y,S){return S=S??u,!!S&&(typeof y=="number"||Q.test(y))&&y>-1&&y%1==0&&y<S}function vo(y){var S=typeof y;return S=="string"||S=="number"||S=="symbol"||S=="boolean"?y!=="__proto__":y===null}function Do(y){return!!me&&me in y}function So(y){var S=y&&y.constructor,F=typeof S=="function"&&S.prototype||ee;return y===F}function xo(y){return we.call(y)}function qt(y){if(y!=null){try{return pe.call(y)}catch{}try{return y+""}catch{}}return""}function ls(y,S){return y===S||y!==y&&S!==S}var Io=os(function(){return arguments}())?os:function(y){return ur(y)&&te.call(y,"callee")&&!_t.call(y,"callee")},Lr=Array.isArray;function Oo(y){return y!=null&&ds(y.length)&&!fs(y)}var ci=cr||Co;function Ao(y,S){return cs(y,S)}function fs(y){if(!gs(y))return!1;var S=hr(y);return S==v||S==x||S==w||S==f}function ds(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=u}function gs(y){var S=typeof y;return y!=null&&(S=="object"||S=="function")}function ur(y){return y!=null&&typeof y=="object"}var ps=le?Ne(le):po;function To(y){return Oo(y)?uo(y):yo(y)}function No(){return[]}function Co(){return!1}r.exports=Ao})(hf,Yr);function uf(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var o=r.charAt(s),u=o.charCodeAt(0);if(t[u]!==255)throw new TypeError(o+" is ambiguous");t[u]=s}var c=r.length,h=r.charAt(0),w=Math.log(c)/Math.log(256),m=Math.log(256)/Math.log(c);function E(x){if(x instanceof Uint8Array||(ArrayBuffer.isView(x)?x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength):Array.isArray(x)&&(x=Uint8Array.from(x))),!(x instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(x.length===0)return"";for(var P=0,A=0,L=0,l=x.length;L!==l&&x[L]===0;)L++,P++;for(var b=(l-L)*m+1>>>0,f=new Uint8Array(b);L!==l;){for(var g=x[L],p=0,n=b-1;(g!==0||p<A)&&n!==-1;n--,p++)g+=256*f[n]>>>0,f[n]=g%c>>>0,g=g/c>>>0;if(g!==0)throw new Error("Non-zero carry");A=p,L++}for(var d=b-A;d!==b&&f[d]===0;)d++;for(var R=h.repeat(P);d<b;++d)R+=r.charAt(f[d]);return R}function C(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return new Uint8Array;var P=0;if(x[P]!==" "){for(var A=0,L=0;x[P]===h;)A++,P++;for(var l=(x.length-P)*w+1>>>0,b=new Uint8Array(l);x[P];){var f=t[x.charCodeAt(P)];if(f===255)return;for(var g=0,p=l-1;(f!==0||g<L)&&p!==-1;p--,g++)f+=c*b[p]>>>0,b[p]=f%256>>>0,f=f/256>>>0;if(f!==0)throw new Error("Non-zero carry");L=g,P++}if(x[P]!==" "){for(var n=l-L;n!==l&&b[n]===0;)n++;for(var d=new Uint8Array(A+(l-n)),R=A;n!==l;)d[R++]=b[n++];return d}}}function v(x){var P=C(x);if(P)return P;throw new Error(`Non-${e} character`)}return{encode:E,decodeUnsafe:C,decode:v}}var lf=uf,ff=lf;const Ta=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},df=r=>new TextEncoder().encode(r),gf=r=>new TextDecoder().decode(r);class pf{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class yf{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Na(this,e)}}class bf{constructor(e){this.decoders=e}or(e){return Na(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Na=(r,e)=>new bf({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class mf{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new pf(e,t,i),this.decoder=new yf(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ai=({name:r,prefix:e,encode:t,decode:i})=>new mf(r,e,t,i),Cr=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=ff(t,e);return ai({prefix:r,name:e,encode:i,decode:o=>Ta(s(o))})},wf=(r,e,t,i)=>{const s={};for(let m=0;m<e.length;++m)s[e[m]]=m;let o=r.length;for(;r[o-1]==="=";)--o;const u=new Uint8Array(o*t/8|0);let c=0,h=0,w=0;for(let m=0;m<o;++m){const E=s[r[m]];if(E===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<t|E,c+=t,c>=8&&(c-=8,u[w++]=255&h>>c)}if(c>=t||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return u},_f=(r,e,t)=>{const i=e[e.length-1]==="=",s=(1<<t)-1;let o="",u=0,c=0;for(let h=0;h<r.length;++h)for(c=c<<8|r[h],u+=8;u>t;)u-=t,o+=e[s&c>>u];if(u&&(o+=e[s&c<<t-u]),i)for(;o.length*t&7;)o+="=";return o},et=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>ai({prefix:e,name:r,encode(s){return _f(s,i,t)},decode(s){return wf(s,i,t,r)}}),Ef=ai({prefix:"\0",name:"identity",encode:r=>gf(r),decode:r=>df(r)});var vf=Object.freeze({__proto__:null,identity:Ef});const Df=et({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Sf=Object.freeze({__proto__:null,base2:Df});const xf=et({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var If=Object.freeze({__proto__:null,base8:xf});const Of=Cr({prefix:"9",name:"base10",alphabet:"0123456789"});var Af=Object.freeze({__proto__:null,base10:Of});const Tf=et({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Nf=et({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Cf=Object.freeze({__proto__:null,base16:Tf,base16upper:Nf});const Pf=et({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Rf=et({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ff=et({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Uf=et({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Lf=et({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Mf=et({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),$f=et({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),jf=et({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),zf=et({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Hf=Object.freeze({__proto__:null,base32:Pf,base32upper:Rf,base32pad:Ff,base32padupper:Uf,base32hex:Lf,base32hexupper:Mf,base32hexpad:$f,base32hexpadupper:jf,base32z:zf});const qf=Cr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Bf=Cr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Kf=Object.freeze({__proto__:null,base36:qf,base36upper:Bf});const Vf=Cr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Gf=Cr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var kf=Object.freeze({__proto__:null,base58btc:Vf,base58flickr:Gf});const Wf=et({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Yf=et({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Jf=et({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Xf=et({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Zf=Object.freeze({__proto__:null,base64:Wf,base64pad:Yf,base64url:Jf,base64urlpad:Xf});const Ca=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Qf=Ca.reduce((r,e,t)=>(r[t]=e,r),[]),ed=Ca.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function td(r){return r.reduce((e,t)=>(e+=Qf[t],e),"")}function rd(r){const e=[];for(const t of r){const i=ed[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const id=ai({prefix:"🚀",name:"base256emoji",encode:td,decode:rd});var sd=Object.freeze({__proto__:null,base256emoji:id}),nd=Pa,un=128,ad=127,od=~ad,cd=Math.pow(2,31);function Pa(r,e,t){e=e||[],t=t||0;for(var i=t;r>=cd;)e[t++]=r&255|un,r/=128;for(;r&od;)e[t++]=r&255|un,r>>>=7;return e[t]=r|0,Pa.bytes=t-i+1,e}var hd=Mi,ud=128,ln=127;function Mi(r,i){var t=0,i=i||0,s=0,o=i,u,c=r.length;do{if(o>=c)throw Mi.bytes=0,new RangeError("Could not decode varint");u=r[o++],t+=s<28?(u&ln)<<s:(u&ln)*Math.pow(2,s),s+=7}while(u>=ud);return Mi.bytes=o-i,t}var ld=Math.pow(2,7),fd=Math.pow(2,14),dd=Math.pow(2,21),gd=Math.pow(2,28),pd=Math.pow(2,35),yd=Math.pow(2,42),bd=Math.pow(2,49),md=Math.pow(2,56),wd=Math.pow(2,63),_d=function(r){return r<ld?1:r<fd?2:r<dd?3:r<gd?4:r<pd?5:r<yd?6:r<bd?7:r<md?8:r<wd?9:10},Ed={encode:nd,decode:hd,encodingLength:_d},Ra=Ed;const fn=(r,e,t=0)=>(Ra.encode(r,e,t),e),dn=r=>Ra.encodingLength(r),$i=(r,e)=>{const t=e.byteLength,i=dn(r),s=i+dn(t),o=new Uint8Array(s+t);return fn(r,o,0),fn(t,o,i),o.set(e,s),new vd(r,t,e,o)};class vd{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const Fa=({name:r,code:e,encode:t})=>new Dd(r,e,t);class Dd{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?$i(this.code,t):t.then(i=>$i(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Ua=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Sd=Fa({name:"sha2-256",code:18,encode:Ua("SHA-256")}),xd=Fa({name:"sha2-512",code:19,encode:Ua("SHA-512")});var Id=Object.freeze({__proto__:null,sha256:Sd,sha512:xd});const La=0,Od="identity",Ma=Ta,Ad=r=>$i(La,Ma(r)),Td={code:La,name:Od,encode:Ma,digest:Ad};var Nd=Object.freeze({__proto__:null,identity:Td});new TextEncoder,new TextDecoder;const gn={...vf,...Sf,...If,...Af,...Cf,...Hf,...Kf,...kf,...Zf,...sd};({...Id,...Nd});function Cd(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function $a(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const pn=$a("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),wi=$a("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Cd(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Pd={utf8:pn,"utf-8":pn,hex:gn.base16,latin1:wi,ascii:wi,binary:wi,...gn};function Rd(r,e="utf8"){const t=Pd[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,"utf8"):t.decoder.decode(`${t.prefix}${r}`)}const ja="wc",Fd=2,ts="core",Mt=`${ja}@${2}:${ts}:`,Ud={name:ts,logger:"error"},Ld={database:":memory:"},Md="crypto",yn="client_ed25519_seed",$d=Z.ONE_DAY,jd="keychain",zd="0.3",Hd="messages",qd="0.3",Bd=Z.SIX_HOURS,Kd="publisher",za="irn",Vd="error",Gd="wss://relay.walletconnect.com",kd="relayer",it={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Wd="_subscription",zr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},bn=Z.ONE_SECOND,Yd="2.3.3",Jd="0.3",Dt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Xd="subscription",Zd="0.3",Qd=Z.FIVE_SECONDS*1e3,eg="pairing",tg="0.3",br={wc_pairingDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:0},res:{ttl:Z.ONE_DAY,prompt:!1,tag:0}}},vt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},rg="history",ig="0.3",sg="expirer",gt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},ng="0.3";class ag{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=jd,this.version=zd,this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()},this.get=i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:o}=K("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(o)}return s},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,va(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Da(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}class og{constructor(e,t,i){this.core=e,this.logger=t,this.name=Md,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),o=Ks(s);return ca(o.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=Zu();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const o=await this.getClientSeed(),u=Ks(o),c=Ri();return await fu(c,s,$d,u)},this.generateSharedKey=(s,o,u)=>{this.isInitialized();const c=this.getPrivateKey(s),h=Qu(c,o);return this.setSymKey(h,u)},this.setSymKey=async(s,o)=>{this.isInitialized();const u=o||el(s);return await this.keychain.set(u,s),u},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,o,u)=>{this.isInitialized();const c=_a(u),h=ji(o);if(Qs(c)){const C=c.senderPublicKey,v=c.receiverPublicKey;s=await this.generateSharedKey(C,v)}const w=this.getSymKey(s),{type:m,senderPublicKey:E}=c;return rl({type:m,symKey:w,message:h,senderPublicKey:E})},this.decode=async(s,o,u)=>{this.isInitialized();const c=nl(o,u);if(Qs(c)){const m=c.receiverPublicKey,E=c.senderPublicKey;s=await this.generateSharedKey(m,E)}const h=this.getSymKey(s),w=il({symKey:h,encoded:o});return jn(w)},this.core=e,this.logger=Se.generateChildLogger(t,this.name),this.keychain=i||new ag(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}getPayloadType(e){const t=Zi(e);return Tr(t.type)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(yn)}catch{e=Ri(),await this.keychain.set(yn,e)}return Rd(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}class cg extends Ec{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=Hd,this.version=qd,this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,s)=>{this.isInitialized();const o=Fi(s);let u=this.messages.get(i);return typeof u>"u"&&(u={}),typeof u[o]<"u"||(u[o]=s,this.messages.set(i,u),await this.persist()),o},this.get=i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s},this.has=(i,s)=>{this.isInitialized();const o=this.get(i),u=Fi(s);return typeof o[u]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Se.generateChildLogger(e,this.name),this.core=t}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,va(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Da(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}class hg extends vc{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new yt.EventEmitter,this.name=Kd,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(i,s,o)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:o}});try{const u=(o==null?void 0:o.ttl)||Bd,c=Ui(o),h=(o==null?void 0:o.prompt)||!1,w=(o==null?void 0:o.tag)||0,m={topic:i,message:s,opts:{ttl:u,relay:c,prompt:h,tag:w}},E=Fi(s);this.queue.set(E,m);try{await await Sa(this.rpcPublish(i,s,u,c,h,w),this.publishTimeout),this.relayer.events.emit(it.publish,m)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(it.connection_stalled);return}this.onPublish(E,m),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:o}})}catch(u){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(u),u}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.relayer=e,this.logger=Se.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(e,t,i,s,o,u){var c,h,w,m;const E={method:Li(s.protocol).publish,params:{topic:e,message:t,ttl:i,prompt:o,tag:u}};return pt((c=E.params)==null?void 0:c.prompt)&&((h=E.params)==null||delete h.prompt),pt((w=E.params)==null?void 0:w.tag)&&((m=E.params)==null||delete m.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:E}),this.relayer.provider.request(E)}onPublish(e,t){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:i,opts:s}=e;await this.publish(t,i,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(Ir.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class ug{constructor(){this.map=new Map,this.set=(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(o=>o!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var lg=Object.defineProperty,fg=Object.defineProperties,dg=Object.getOwnPropertyDescriptors,mn=Object.getOwnPropertySymbols,gg=Object.prototype.hasOwnProperty,pg=Object.prototype.propertyIsEnumerable,wn=(r,e,t)=>e in r?lg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Hr=(r,e)=>{for(var t in e||(e={}))gg.call(e,t)&&wn(r,t,e[t]);if(mn)for(var t of mn(e))pg.call(e,t)&&wn(r,t,e[t]);return r},_i=(r,e)=>fg(r,dg(e));class yg extends xc{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new ug,this.events=new yt.EventEmitter,this.name=Xd,this.version=Zd,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=Mt,this.subscribeTimeout=1e4,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(i,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const o=Ui(s),u={topic:i,relay:o};this.pending.set(i,u);const c=await this.rpcSubscribe(i,o);return this.onSubscribe(c,u),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}}),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}},this.unsubscribe=async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((s,o)=>{const u=new Z.Watch;u.start(this.pendingSubscriptionWatchLabel);const c=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(c),u.stop(this.pendingSubscriptionWatchLabel),s(!0)),u.elapsed(this.pendingSubscriptionWatchLabel)>=Qd&&(clearInterval(c),u.stop(this.pendingSubscriptionWatchLabel),o(!1))},this.pendingSubInterval)}),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.restart=async()=>{await this.restore(),await this.reset()},this.relayer=e,this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const s=Ui(i);await this.rpcUnsubscribe(e,t,s);const o=Je("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,o),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t){const i={method:Li(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await Sa(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(it.connection_stalled)}return s}rpcUnsubscribe(e,t,i){const s={method:Li(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.provider.request(s)}onSubscribe(e,t){this.setSubscription(e,_i(Hr({},t),{id:e})),this.pending.delete(t.topic)}onResubscribe(e,t){this.addSubscription(e,_i(Hr({},t),{id:e})),this.pending.delete(t.topic)}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,Hr({},t)),this.topicMap.set(t.topic,e),this.events.emit(Dt.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=K("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Dt.deleted,_i(Hr({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Dt.sync)}async reset(){this.cached.length&&await Promise.all(this.cached.map(async e=>await this.resubscribe(e))),this.events.emit(Dt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=K("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:t,relay:i}=e,s={topic:t,relay:i};this.pending.set(s.topic,s);const o=await this.rpcSubscribe(s.topic,s.relay);this.onResubscribe(o,s)}}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.relayer.transportExplicitlyClosed||this.pending.forEach(async e=>{const t=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(t,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(Ir.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.on(it.connect,async()=>{await this.onConnect()}),this.relayer.on(it.disconnect,()=>{this.onDisconnect()}),this.events.on(Dt.created,async e=>{const t=Dt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(Dt.deleted,async e=>{const t=Dt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}var bg=Object.defineProperty,_n=Object.getOwnPropertySymbols,mg=Object.prototype.hasOwnProperty,wg=Object.prototype.propertyIsEnumerable,En=(r,e,t)=>e in r?bg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_g=(r,e)=>{for(var t in e||(e={}))mg.call(e,t)&&En(r,t,e[t]);if(_n)for(var t of _n(e))wg.call(e,t)&&En(r,t,e[t]);return r};class Eg extends Dc{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new yt.EventEmitter,this.name=kd,this.transportExplicitlyClosed=!1,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Se.generateChildLogger(e.logger,this.name):Sr(Se.getDefaultLoggerOptions({level:e.logger||Vd})),this.messages=new cg(this.logger,e.core),this.subscriber=new yg(this,this.logger),this.publisher=new hg(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Gd,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t})}async subscribe(e,t){this.isInitialized();let i="";return await Promise.all([new Promise(s=>{this.subscriber.once(Dt.created,o=>{o.topic===e&&s()})}),new Promise(async s=>{i=await this.subscriber.subscribe(e,t),s()})]),i}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(it.transport_closed))}async transportOpen(e){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1;try{await Promise.all([new Promise(t=>{this.initialized||t(),this.subscriber.once(Dt.resubscribed,()=>{t()})}),await Promise.race([this.provider.connect(),new Promise((t,i)=>this.once(it.transport_closed,()=>{i(new Error("closeTransport called before connection was established"))}))])])}catch(t){const i=t;if(!/socket hang up/i.test(i.message))throw new Error(i.message);this.logger.error(i),this.events.emit(it.transport_closed)}}async restartTransport(e){await this.transportClose(),await new Promise(t=>setTimeout(t,bn)),await this.transportOpen(e)}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new Dr(new cf(wl({sdkVersion:Yd,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:t,message:i}=e;await this.messages.set(t,i)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;return await this.subscriber.isSubscribed(t)?this.messages.has(t,i):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Hi(e)){if(!e.method.endsWith(Wd))return;const t=e.params,{topic:i,message:s}=t.data,o={topic:i,message:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(_g({type:"event",event:t.id},o)),this.events.emit(t.id,o),await this.acknowledgePayload(e),await this.onMessageEvent(o)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(it.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=qi(e.id,!0);await this.provider.connection.send(t)}registerEventListeners(){this.provider.on(zr.payload,e=>this.onProviderPayload(e)),this.provider.on(zr.connect,()=>{this.events.emit(it.connect)}),this.provider.on(zr.disconnect,()=>{this.events.emit(it.disconnect),this.attemptToReconnect()}),this.provider.on(zr.error,e=>this.events.emit(it.error,e)),this.events.on(it.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},Z.toMiliseconds(bn))}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}var vg=Object.defineProperty,vn=Object.getOwnPropertySymbols,Dg=Object.prototype.hasOwnProperty,Sg=Object.prototype.propertyIsEnumerable,Dn=(r,e,t)=>e in r?vg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Sn=(r,e)=>{for(var t in e||(e={}))Dg.call(e,t)&&Dn(r,t,e[t]);if(vn)for(var t of vn(e))Sg.call(e,t)&&Dn(r,t,e[t]);return r};class oi extends Sc{constructor(e,t,i,s=Mt,o=void 0){super(e,t,i,s),this.core=e,this.logger=t,this.name=i,this.map=new Map,this.version=Jd,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(u=>{zl(u)?this.map.set(u.id,u):Hl(u)?this.map.set(u.topic,u):this.getKey&&u!==null&&!pt(u)&&this.map.set(this.getKey(u),u)}),this.cached=[],this.initialized=!0)},this.set=async(u,c)=>{this.isInitialized(),this.map.has(u)?await this.update(u,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:u,value:c}),this.map.set(u,c),await this.persist())},this.get=u=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:u}),this.getData(u)),this.getAll=u=>(this.isInitialized(),u?this.values.filter(c=>Object.keys(u).every(h=>Yr(c[h],u[h]))):this.values),this.update=async(u,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:u,update:c});const h=Sn(Sn({},this.getData(u)),c);this.map.set(u,h),await this.persist()},this.delete=async(u,c)=>{this.isInitialized(),this.map.has(u)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:u,reason:c}),this.map.delete(u),await this.persist())},this.logger=Se.generateChildLogger(t,this.name),this.storagePrefix=s,this.getKey=o}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:i}=K("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=K("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}class xg{constructor(e,t){this.core=e,this.logger=t,this.name=eg,this.version=tg,this.events=new yt,this.initialized=!1,this.storagePrefix=Mt,this.ignoredPayloadTypes=[Zt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Ri(),s=await this.core.crypto.setSymKey(i),o=St(Z.FIVE_MINUTES),u={protocol:za},c={topic:s,expiry:o,relay:u,active:!1},h=Nl({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:u});return await this.pairings.set(s,c),await this.core.relayer.subscribe(s),this.core.expirer.set(s,o),{topic:s,uri:h}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:s,symKey:o,relay:u}=Al(i.uri),c=St(Z.FIVE_MINUTES),h={topic:s,relay:u,expiry:c,active:!1};return await this.pairings.set(s,h),await this.core.crypto.setSymKey(o,s),await this.core.relayer.subscribe(s,{relay:u}),this.core.expirer.set(s,c),i.activatePairing&&await this.activate({topic:s}),h},this.activate=async({topic:i})=>{this.isInitialized();const s=St(Z.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:s}),this.core.expirer.set(i,s)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.pairings.keys.includes(s)){const o=await this.sendRequest(s,"wc_pairingPing",{}),{done:u,resolve:c,reject:h}=Wt();this.events.once(Ue("pairing_ping",o),({error:w})=>{w?h(w):c()}),await u()}},this.updateExpiry=async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})},this.updateMetadata=async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",Je("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(i,s,o)=>{const u=Bi(s,o),c=await this.core.crypto.encode(i,u),h=br[s].req;return this.core.history.set(i,u),await this.core.relayer.publish(i,c,h),u.id},this.sendResult=async(i,s,o)=>{const u=qi(i,o),c=await this.core.crypto.encode(s,u),h=await this.core.history.get(s,i),w=br[h.request.method].res;await this.core.relayer.publish(s,c,w),await this.core.history.resolve(u)},this.sendError=async(i,s,o)=>{const u=zi(i,o),c=await this.core.crypto.encode(s,u),h=await this.core.history.get(s,i),w=br[h.request.method]?br[h.request.method].res:br.unregistered_method.res;await this.core.relayer.publish(s,c,w),await this.core.history.resolve(u)},this.deletePairing=async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Je("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(s=>Ut(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=i=>{const{topic:s,payload:o}=i,u=o.method;if(this.pairings.keys.includes(s))switch(u){case"wc_pairingPing":return this.onPairingPingRequest(s,o);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,o);default:return this.onUnknownRpcMethodRequest(s,o)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:o}=i,u=(await this.core.history.get(s,o.id)).request.method;if(this.pairings.keys.includes(s))switch(u){case"wc_pairingPing":return this.onPairingPingResponse(s,o);default:return this.onUnknownRpcMethodResponse(u)}},this.onPairingPingRequest=async(i,s)=>{const{id:o}=s;try{this.isValidPing({topic:i}),await this.sendResult(o,i,!0),this.events.emit("pairing_ping",{id:o,topic:i})}catch(u){await this.sendError(o,i,u),this.logger.error(u)}},this.onPairingPingResponse=(i,s)=>{const{id:o}=s;setTimeout(()=>{Ft(s)?this.events.emit(Ue("pairing_ping",o),{}):Tt(s)&&this.events.emit(Ue("pairing_ping",o),{error:s.error})},500)},this.onPairingDeleteRequest=async(i,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:i}),await this.sendResult(o,i,!0),await this.deletePairing(i),this.events.emit("pairing_delete",{id:o,topic:i})}catch(u){await this.sendError(o,i,u),this.logger.error(u)}},this.onUnknownRpcMethodRequest=async(i,s)=>{const{id:o,method:u}=s;try{if(this.registeredMethods.includes(u))return;const c=Je("WC_METHOD_UNSUPPORTED",u);await this.sendError(o,i,c),this.logger.error(c)}catch(c){await this.sendError(o,i,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(Je("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!nt(i)){const{message:s}=K("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(s)}if(!jl(i.uri)){const{message:s}=K("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(s)}},this.isValidPing=async i=>{if(!nt(i)){const{message:o}=K("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(o)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidDisconnect=async i=>{if(!nt(i)){const{message:o}=K("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(o)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async i=>{if(!Ze(i,!1)){const{message:s}=K("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=K("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(Ut(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=K("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}},this.core=e,this.logger=Se.generateChildLogger(t,this.name),this.pairings=new oi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(it.message,async e=>{const{topic:t,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const s=await this.core.crypto.decode(t,i);Hi(s)?(this.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):zn(s)&&(await this.core.history.resolve(s),this.onRelayEventResponse({topic:t,payload:s}))})}registerExpirerEvents(){this.core.expirer.on(gt.expired,async e=>{const{topic:t}=Ia(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit("pairing_expire",{topic:t}))})}}class Ig extends _c{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new yt.EventEmitter,this.name=rg,this.version=ig,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,s,o)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:o}),this.records.has(s.id))return;const u={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:o};this.records.set(u.id,u),this.events.emit(vt.created,u)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=Tt(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.events.emit(vt.updated,s))},this.get=async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s)),this.delete=(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(o=>{if(o.topic===i){if(typeof s<"u"&&o.id!==s)return;this.records.delete(o.id),this.events.emit(vt.deleted,o)}})},this.exists=async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const i={topic:t.topic,request:Bi(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=K("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(vt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=K("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(vt.created,e=>{const t=vt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(vt.updated,e=>{const t=vt.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(vt.deleted,e=>{const t=vt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Og extends Ic{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new yt.EventEmitter,this.name=sg,this.version=ng,this.cached=[],this.initialized=!1,this.storagePrefix=Mt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(i,s)=>{this.isInitialized();const o=this.formatTarget(i),u={target:o,expiry:s};this.expirations.set(o,u),this.checkExpiry(o,u),this.events.emit(gt.created,{target:o,expiration:u})},this.get=i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)},this.del=i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),o=this.getExpiration(s);this.expirations.delete(s),this.events.emit(gt.deleted,{target:s,expiration:o})}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=Se.generateChildLogger(t,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return _l(e);if(typeof e=="number")return El(e);const{message:t}=K("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(gt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=K("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=K("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;Z.toMiliseconds(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(gt.expired,{target:e,expiration:t})}checkExpirations(){this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Ir.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(gt.created,e=>{const t=gt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(gt.expired,e=>{const t=gt.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(gt.deleted,e=>{const t=gt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Ag=Object.defineProperty,xn=Object.getOwnPropertySymbols,Tg=Object.prototype.hasOwnProperty,Ng=Object.prototype.propertyIsEnumerable,In=(r,e,t)=>e in r?Ag(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,On=(r,e)=>{for(var t in e||(e={}))Tg.call(e,t)&&In(r,t,e[t]);if(xn)for(var t of xn(e))Ng.call(e,t)&&In(r,t,e[t]);return r};class rs extends wc{constructor(e){super(e),this.protocol=ja,this.version=Fd,this.name=ts,this.events=new yt.EventEmitter,this.initialized=!1,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.projectId=e==null?void 0:e.projectId;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Sr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Ud.logger}));this.logger=Se.generateChildLogger(t,this.name),this.heartbeat=new Ir.HeartBeat,this.crypto=new og(this,this.logger,e==null?void 0:e.keychain),this.history=new Ig(this,this.logger),this.expirer=new Og(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new sc(On(On({},Ld),e==null?void 0:e.storageOptions)),this.relayer=new Eg({core:this,logger:this.logger,relayUrl:e==null?void 0:e.relayUrl,projectId:this.projectId}),this.pairing=new xg(this,this.logger)}static async init(e){const t=new rs(e);return await t.initialize(),t}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const Cg=rs,Ha="wc",qa=2,Ba="client",is=`${Ha}@${qa}:${Ba}:`,Ei={name:Ba,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Pg="proposal",Rg="session",qr=Z.SEVEN_DAYS,Fg="engine",mr={wc_sessionPropose:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1115}}},vi={min:Z.FIVE_MINUTES,max:Z.SEVEN_DAYS},Ug="request";var Lg=Object.defineProperty,Mg=Object.defineProperties,$g=Object.getOwnPropertyDescriptors,An=Object.getOwnPropertySymbols,jg=Object.prototype.hasOwnProperty,zg=Object.prototype.propertyIsEnumerable,Tn=(r,e,t)=>e in r?Lg(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,At=(r,e)=>{for(var t in e||(e={}))jg.call(e,t)&&Tn(r,t,e[t]);if(An)for(var t of An(e))zg.call(e,t)&&Tn(r,t,e[t]);return r},Di=(r,e)=>Mg(r,$g(e));class Hg extends Ac{constructor(e){super(e),this.name=Fg,this.events=new yt,this.initialized=!1,this.ignoredPayloadTypes=[Zt],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(mr)}),this.initialized=!0)},this.connect=async t=>{this.isInitialized(),await this.isValidConnect(t);const{pairingTopic:i,requiredNamespaces:s,relays:o}=t;let u=i,c,h=!1;if(u&&(h=this.client.core.pairing.pairings.get(u).active),!u||!h){const{topic:A,uri:L}=await this.client.core.pairing.create();u=A,c=L}const w=await this.client.core.crypto.generateKeyPair(),m={requiredNamespaces:s,relays:o??[{protocol:za}],proposer:{publicKey:w,metadata:this.client.metadata}},{reject:E,resolve:C,done:v}=Wt();if(this.events.once(Ue("session_connect"),async({error:A,session:L})=>{if(A)E(A);else if(L){L.self.publicKey=w;const l=Di(At({},L),{requiredNamespaces:L.requiredNamespaces});await this.client.session.set(L.topic,l),await this.setExpiry(L.topic,L.expiry),u&&await this.client.core.pairing.updateMetadata({topic:u,metadata:L.peer.metadata}),C(l)}}),!u){const{message:A}=K("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(A)}const x=await this.sendRequest(u,"wc_sessionPropose",m),P=St(Z.FIVE_MINUTES);return await this.setProposal(x,At({id:x,expiry:P},m)),{uri:c,approval:v}},this.pair=async t=>(this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{this.isInitialized(),await this.isValidApprove(t);const{id:i,relayProtocol:s,namespaces:o}=t,u=this.client.proposal.get(i);let{pairingTopic:c,proposer:h,requiredNamespaces:w}=u;Wr(w)||(w=Fl(o,"approve()"),this.client.proposal.set(i,Di(At({},u),{requiredNamespaces:w})));const m=await this.client.core.crypto.generateKeyPair(),E=h.publicKey,C=await this.client.core.crypto.generateSharedKey(m,E),v={relay:{protocol:s??"irn"},namespaces:o,requiredNamespaces:w,controller:{publicKey:m,metadata:this.client.metadata},expiry:St(qr)};await this.client.core.relayer.subscribe(C);const x=await this.sendRequest(C,"wc_sessionSettle",v),{done:P,resolve:A,reject:L}=Wt();this.events.once(Ue("session_approve",x),({error:b})=>{b?L(b):A(this.client.session.get(C))});const l=Di(At({},v),{topic:C,acknowledged:!1,self:v.controller,peer:{publicKey:h.publicKey,metadata:h.metadata},controller:m});return await this.client.session.set(C,l),await this.setExpiry(C,St(qr)),c&&await this.client.core.pairing.updateMetadata({topic:c,metadata:l.peer.metadata}),c&&i&&(await this.sendResult(i,c,{relay:{protocol:s??"irn"},responderPublicKey:m}),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:c})),{topic:C,acknowledged:P}},this.reject=async t=>{this.isInitialized(),await this.isValidReject(t);const{id:i,reason:s}=t,{pairingTopic:o}=this.client.proposal.get(i);o&&(await this.sendError(i,o,s),await this.client.proposal.delete(i,Je("USER_DISCONNECTED")))},this.update=async t=>{this.isInitialized(),await this.isValidUpdate(t);const{topic:i,namespaces:s}=t,o=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:s}),{done:u,resolve:c,reject:h}=Wt();return this.events.once(Ue("session_update",o),({error:w})=>{w?h(w):c()}),await this.client.session.update(i,{namespaces:s}),{acknowledged:u}},this.extend=async t=>{this.isInitialized(),await this.isValidExtend(t);const{topic:i}=t,s=await this.sendRequest(i,"wc_sessionExtend",{}),{done:o,resolve:u,reject:c}=Wt();return this.events.once(Ue("session_extend",s),({error:h})=>{h?c(h):u()}),await this.setExpiry(i,St(qr)),{acknowledged:o}},this.request=async t=>{this.isInitialized(),await this.isValidRequest(t);const{chainId:i,request:s,topic:o,expiry:u}=t,c=await this.sendRequest(o,"wc_sessionRequest",{request:s,chainId:i},u),{done:h,resolve:w,reject:m}=Wt(u);return this.events.once(Ue("session_request",c),({error:E,result:C})=>{E?m(E):w(C)}),await h()},this.respond=async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:i,response:s}=t,{id:o}=s;Ft(s)?await this.sendResult(o,i,s.result):Tt(s)&&await this.sendError(o,i,s.error),this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0})},this.ping=async t=>{this.isInitialized(),await this.isValidPing(t);const{topic:i}=t;if(this.client.session.keys.includes(i)){const s=await this.sendRequest(i,"wc_sessionPing",{}),{done:o,resolve:u,reject:c}=Wt();this.events.once(Ue("session_ping",s),({error:h})=>{h?c(h):u()}),await o()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async t=>{this.isInitialized(),await this.isValidEmit(t);const{topic:i,event:s,chainId:o}=t;await this.sendRequest(i,"wc_sessionEvent",{event:s,chainId:o})},this.disconnect=async t=>{this.isInitialized(),await this.isValidDisconnect(t);const{topic:i}=t;this.client.session.keys.includes(i)?(await this.sendRequest(i,"wc_sessionDelete",Je("USER_DISCONNECTED")),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(i=>Ml(i,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(t,i)=>{const{self:s}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),await Promise.all([this.client.session.delete(t,Je("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.deleteSymKey(t),i?Promise.resolve():this.client.core.expirer.del(t)])},this.deleteProposal=async(t,i)=>{await Promise.all([this.client.proposal.delete(t,Je("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,i),s?Promise.resolve():this.client.core.expirer.del(t)])},this.setExpiry=async(t,i)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:i}),this.client.core.expirer.set(t,i)},this.setProposal=async(t,i)=>{await this.client.proposal.set(t,i),this.client.core.expirer.set(t,i.expiry)},this.setPendingSessionRequest=async t=>{const i=mr.wc_sessionRequest.req.ttl,{id:s,topic:o,params:u}=t;await this.client.pendingRequest.set(s,{id:s,topic:o,params:u}),i&&this.client.core.expirer.set(s,St(i))},this.sendRequest=async(t,i,s,o)=>{const u=Bi(i,s),c=await this.client.core.crypto.encode(t,u),h=mr[i].req;return o&&(h.ttl=o),this.client.core.history.set(t,u),this.client.core.relayer.publish(t,c,h),u.id},this.sendResult=async(t,i,s)=>{const o=qi(t,s),u=await this.client.core.crypto.encode(i,o),c=await this.client.core.history.get(i,t),h=mr[c.request.method].res;this.client.core.relayer.publish(i,u,h),await this.client.core.history.resolve(o)},this.sendError=async(t,i,s)=>{const o=zi(t,s),u=await this.client.core.crypto.encode(i,o),c=await this.client.core.history.get(i,t),h=mr[c.request.method].res;this.client.core.relayer.publish(i,u,h),await this.client.core.history.resolve(o)},this.cleanup=async()=>{const t=[],i=[];this.client.session.getAll().forEach(s=>{Ut(s.expiry)&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Ut(s.expiry)&&i.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession(s)),...i.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=t=>{const{topic:i,payload:s}=t,o=s.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeRequest(i,s);case"wc_sessionSettle":return this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return this.onSessionExtendRequest(i,s);case"wc_sessionPing":return this.onSessionPingRequest(i,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return this.onSessionRequest(i,s);case"wc_sessionEvent":return this.onSessionEventRequest(i,s);default:return this.client.logger.info(`Unsupported request method ${o}`)}},this.onRelayEventResponse=async t=>{const{topic:i,payload:s}=t,o=(await this.client.core.history.get(i,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}},this.onSessionProposeRequest=async(t,i)=>{const{params:s,id:o}=i;try{this.isValidConnect(At({},i.params));const u=St(Z.FIVE_MINUTES),c=At({id:o,pairingTopic:t,expiry:u},s);await this.setProposal(o,c),this.client.events.emit("session_proposal",{id:o,params:c})}catch(u){await this.sendError(o,t,u),this.client.logger.error(u)}},this.onSessionProposeResponse=async(t,i)=>{const{id:s}=i;if(Ft(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const u=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:u});const c=u.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const h=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const w=await this.client.core.crypto.generateSharedKey(c,h);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:w});const m=await this.client.core.relayer.subscribe(w);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:m}),await this.client.core.pairing.activate({topic:t})}else Tt(i)&&(await this.client.proposal.delete(s,Je("USER_DISCONNECTED")),this.events.emit(Ue("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(t,i)=>{const{id:s,params:o}=i;try{this.isValidSessionSettleRequest(o);const{relay:u,controller:c,expiry:h,namespaces:w,requiredNamespaces:m}=i.params,E={topic:t,relay:u,expiry:h,namespaces:w,acknowledged:!0,requiredNamespaces:m,controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}};await this.sendResult(i.id,t,!0),this.events.emit(Ue("session_connect"),{session:E})}catch(u){await this.sendError(s,t,u),this.client.logger.error(u)}},this.onSessionSettleResponse=async(t,i)=>{const{id:s}=i;Ft(i)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Ue("session_approve",s),{})):Tt(i)&&(await this.client.session.delete(t,Je("USER_DISCONNECTED")),this.events.emit(Ue("session_approve",s),{error:i.error}))},this.onSessionUpdateRequest=async(t,i)=>{const{params:s,id:o}=i;try{this.isValidUpdate(At({topic:t},s)),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult(o,t,!0),this.client.events.emit("session_update",{id:o,topic:t,params:s})}catch(u){await this.sendError(o,t,u),this.client.logger.error(u)}},this.onSessionUpdateResponse=(t,i)=>{const{id:s}=i;Ft(i)?this.events.emit(Ue("session_update",s),{}):Tt(i)&&this.events.emit(Ue("session_update",s),{error:i.error})},this.onSessionExtendRequest=async(t,i)=>{const{id:s}=i;try{this.isValidExtend({topic:t}),await this.setExpiry(t,St(qr)),await this.sendResult(s,t,!0),this.client.events.emit("session_extend",{id:s,topic:t})}catch(o){await this.sendError(s,t,o),this.client.logger.error(o)}},this.onSessionExtendResponse=(t,i)=>{const{id:s}=i;Ft(i)?this.events.emit(Ue("session_extend",s),{}):Tt(i)&&this.events.emit(Ue("session_extend",s),{error:i.error})},this.onSessionPingRequest=async(t,i)=>{const{id:s}=i;try{this.isValidPing({topic:t}),await this.sendResult(s,t,!0),this.client.events.emit("session_ping",{id:s,topic:t})}catch(o){await this.sendError(s,t,o),this.client.logger.error(o)}},this.onSessionPingResponse=(t,i)=>{const{id:s}=i;setTimeout(()=>{Ft(i)?this.events.emit(Ue("session_ping",s),{}):Tt(i)&&this.events.emit(Ue("session_ping",s),{error:i.error})},500)},this.onSessionDeleteRequest=async(t,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:t,reason:i.params}),this.client.core.relayer.once(it.publish,async()=>{await this.deleteSession(t)}),await this.sendResult(s,t,!0),this.client.events.emit("session_delete",{id:s,topic:t})}catch(o){await this.sendError(s,t,o),this.client.logger.error(o)}},this.onSessionRequest=async(t,i)=>{const{id:s,params:o}=i;try{this.isValidRequest(At({topic:t},o)),await this.setPendingSessionRequest({id:s,topic:t,params:o}),this.client.events.emit("session_request",{id:s,topic:t,params:o})}catch(u){await this.sendError(s,t,u),this.client.logger.error(u)}},this.onSessionRequestResponse=(t,i)=>{const{id:s}=i;Ft(i)?this.events.emit(Ue("session_request",s),{result:i.result}):Tt(i)&&this.events.emit(Ue("session_request",s),{error:i.error})},this.onSessionEventRequest=async(t,i)=>{const{id:s,params:o}=i;try{this.isValidEmit(At({topic:t},o)),this.client.events.emit("session_event",{id:s,topic:t,params:o})}catch(u){await this.sendError(s,t,u),this.client.logger.error(u)}},this.isValidConnect=async t=>{if(!nt(t)){const{message:c}=K("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(c)}const{pairingTopic:i,requiredNamespaces:s,relays:o}=t;if(pt(i)||await this.isValidPairingTopic(i),!pt(s)&&Wr(s)===0)return;const u=Wl(s,"connect()");if(u)throw new Error(u.message);if(!Yl(o,!0)){const{message:c}=K("MISSING_OR_INVALID",`connect() relays: ${o}`);throw new Error(c)}},this.isValidApprove=async t=>{if(!nt(t))throw new Error(K("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:i,namespaces:s,relayProtocol:o}=t;await this.isValidProposalId(i);const u=this.client.proposal.get(i),c=Br(s,"approve()");if(c)throw new Error(c.message);const h=cn(u.requiredNamespaces,s,"update()");if(h)throw new Error(h.message);if(!Ze(o,!0)){const{message:w}=K("MISSING_OR_INVALID",`approve() relayProtocol: ${o}`);throw new Error(w)}},this.isValidReject=async t=>{if(!nt(t)){const{message:o}=K("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(o)}const{id:i,reason:s}=t;if(await this.isValidProposalId(i),!Xl(s)){const{message:o}=K("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidSessionSettleRequest=t=>{if(!nt(t)){const{message:w}=K("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(w)}const{relay:i,controller:s,namespaces:o,expiry:u}=t;if(!Aa(i)){const{message:w}=K("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(w)}const c=ql(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);const h=Br(o,"onSessionSettleRequest()");if(h)throw new Error(h.message);if(Ut(u)){const{message:w}=K("EXPIRED","onSessionSettleRequest()");throw new Error(w)}},this.isValidUpdate=async t=>{if(!nt(t)){const{message:h}=K("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(h)}const{topic:i,namespaces:s}=t;await this.isValidSessionTopic(i);const o=this.client.session.get(i),u=Br(s,"update()");if(u)throw new Error(u.message);const c=cn(o.requiredNamespaces,s,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async t=>{if(!nt(t)){const{message:s}=K("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionTopic(i)},this.isValidRequest=async t=>{if(!nt(t)){const{message:h}=K("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(h)}const{topic:i,request:s,chainId:o,expiry:u}=t;await this.isValidSessionTopic(i);const{namespaces:c}=this.client.session.get(i);if(!on(c,o)){const{message:h}=K("MISSING_OR_INVALID",`request() chainId: ${o}`);throw new Error(h)}if(!Zl(s)){const{message:h}=K("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(h)}if(!tf(c,o,s.method)){const{message:h}=K("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(h)}if(u&&!sf(u,vi)){const{message:h}=K("MISSING_OR_INVALID",`request() expiry: ${u}. Expiry must be a number (in seconds) between ${vi.min} and ${vi.max}`);throw new Error(h)}},this.isValidRespond=async t=>{if(!nt(t)){const{message:o}=K("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}const{topic:i,response:s}=t;if(await this.isValidSessionTopic(i),!Ql(s)){const{message:o}=K("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}},this.isValidPing=async t=>{if(!nt(t)){const{message:s}=K("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async t=>{if(!nt(t)){const{message:c}=K("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(c)}const{topic:i,event:s,chainId:o}=t;await this.isValidSessionTopic(i);const{namespaces:u}=this.client.session.get(i);if(!on(u,o)){const{message:c}=K("MISSING_OR_INVALID",`emit() chainId: ${o}`);throw new Error(c)}if(!ef(s)){const{message:c}=K("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}if(!rf(u,o,s.name)){const{message:c}=K("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidDisconnect=async t=>{if(!nt(t)){const{message:s}=K("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}}isInitialized(){if(!this.initialized){const{message:e}=K("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(it.message,async e=>{const{topic:t,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const s=await this.client.core.crypto.decode(t,i);Hi(s)?(this.client.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):zn(s)&&(await this.client.core.history.resolve(s),this.onRelayEventResponse({topic:t,payload:s}))})}registerExpirerEvents(){this.client.core.expirer.on(gt.expired,async e=>{const{topic:t,id:i}=Ia(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,K("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}isValidPairingTopic(e){if(!Ze(e,!1)){const{message:t}=K("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=K("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(Ut(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=K("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!Ze(e,!1)){const{message:t}=K("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(!this.client.session.keys.includes(e)){const{message:t}=K("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(Ut(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:t}=K("EXPIRED",`session topic: ${e}`);throw new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ze(e,!1)){const{message:t}=K("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=K("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!Jl(e)){const{message:t}=K("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=K("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(Ut(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:t}=K("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class qg extends oi{constructor(e,t){super(e,t,Pg,is),this.core=e,this.logger=t}}class Bg extends oi{constructor(e,t){super(e,t,Rg,is),this.core=e,this.logger=t}}class Kg extends oi{constructor(e,t){super(e,t,Ug,is),this.core=e,this.logger=t}}class ss extends Oc{constructor(e){super(e),this.protocol=Ha,this.version=qa,this.name=Ei.name,this.events=new yt.EventEmitter,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}},this.update=async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}},this.request=async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}},this.find=i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||Ei.name,this.metadata=(e==null?void 0:e.metadata)||pl();const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Sr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Ei.logger}));this.core=(e==null?void 0:e.core)||new Cg(e),this.logger=Se.generateChildLogger(t,this.name),this.session=new Bg(this.core,this.logger),this.proposal=new qg(this.core,this.logger),this.pendingRequest=new Kg(this.core,this.logger),this.engine=new Hg(this)}static async init(e){const t=new ss(e);return await t.initialize(),t}get context(){return Se.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.getLocalStorage=Ie.getLocalStorageOrThrow=Ie.getCrypto=Ie.getCryptoOrThrow=Ie.getLocation=Ie.getLocationOrThrow=Ie.getNavigator=Ie.getNavigatorOrThrow=Ie.getDocument=Ie.getDocumentOrThrow=Ie.getFromWindowOrThrow=Ie.getFromWindow=void 0;function Qt(r){let e;return typeof window<"u"&&typeof window[r]<"u"&&(e=window[r]),e}Ie.getFromWindow=Qt;function or(r){const e=Qt(r);if(!e)throw new Error(`${r} is not defined in Window`);return e}Ie.getFromWindowOrThrow=or;function Vg(){return or("document")}Ie.getDocumentOrThrow=Vg;function Gg(){return Qt("document")}Ie.getDocument=Gg;function kg(){return or("navigator")}Ie.getNavigatorOrThrow=kg;function Wg(){return Qt("navigator")}Ie.getNavigator=Wg;function Yg(){return or("location")}Ie.getLocationOrThrow=Yg;function Jg(){return Qt("location")}Ie.getLocation=Jg;function Xg(){return or("crypto")}Ie.getCryptoOrThrow=Xg;function Zg(){return Qt("crypto")}Ie.getCrypto=Zg;function Qg(){return or("localStorage")}Ie.getLocalStorageOrThrow=Qg;function ep(){return Qt("localStorage")}Ie.getLocalStorage=ep;var ns={};Object.defineProperty(ns,"__esModule",{value:!0});ns.getWindowMetadata=void 0;const Nn=Ie;function tp(){let r,e;try{r=Nn.getDocumentOrThrow(),e=Nn.getLocationOrThrow()}catch{return null}function t(){const E=r.getElementsByTagName("link"),C=[];for(let v=0;v<E.length;v++){const x=E[v],P=x.getAttribute("rel");if(P&&P.toLowerCase().indexOf("icon")>-1){const A=x.getAttribute("href");if(A)if(A.toLowerCase().indexOf("https:")===-1&&A.toLowerCase().indexOf("http:")===-1&&A.indexOf("//")!==0){let L=e.protocol+"//"+e.host;if(A.indexOf("/")===0)L+=A;else{const l=e.pathname.split("/");l.pop();const b=l.join("/");L+=b+"/"+A}C.push(L)}else if(A.indexOf("//")===0){const L=e.protocol+A;C.push(L)}else C.push(A)}}return C}function i(...E){const C=r.getElementsByTagName("meta");for(let v=0;v<C.length;v++){const x=C[v],P=["itemprop","property","name"].map(A=>x.getAttribute(A)).filter(A=>A?E.includes(A):!1);if(P.length&&P){const A=x.getAttribute("content");if(A)return A}}return""}function s(){let E=i("name","og:site_name","og:title","twitter:title");return E||(E=r.title),E}function o(){return i("description","og:description","twitter:description","keywords")}const u=s(),c=o(),h=e.origin,w=t();return{description:c,url:h,icons:w,name:u}}ns.getWindowMetadata=tp;var rp={};(function(r){const e=Mn,t=$n,i=Ln,s=ba,o=l=>l==null,u=Symbol("encodeFragmentIdentifier");function c(l){switch(l.arrayFormat){case"index":return b=>(f,g)=>{const p=f.length;return g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[m(b,l),"[",p,"]"].join("")]:[...f,[m(b,l),"[",m(p,l),"]=",m(g,l)].join("")]};case"bracket":return b=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[m(b,l),"[]"].join("")]:[...f,[m(b,l),"[]=",m(g,l)].join("")];case"colon-list-separator":return b=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,[m(b,l),":list="].join("")]:[...f,[m(b,l),":list=",m(g,l)].join("")];case"comma":case"separator":case"bracket-separator":{const b=l.arrayFormat==="bracket-separator"?"[]=":"=";return f=>(g,p)=>p===void 0||l.skipNull&&p===null||l.skipEmptyString&&p===""?g:(p=p===null?"":p,g.length===0?[[m(f,l),b,m(p,l)].join("")]:[[g,m(p,l)].join(l.arrayFormatSeparator)])}default:return b=>(f,g)=>g===void 0||l.skipNull&&g===null||l.skipEmptyString&&g===""?f:g===null?[...f,m(b,l)]:[...f,[m(b,l),"=",m(g,l)].join("")]}}function h(l){let b;switch(l.arrayFormat){case"index":return(f,g,p)=>{if(b=/\[(\d*)\]$/.exec(f),f=f.replace(/\[\d*\]$/,""),!b){p[f]=g;return}p[f]===void 0&&(p[f]={}),p[f][b[1]]=g};case"bracket":return(f,g,p)=>{if(b=/(\[\])$/.exec(f),f=f.replace(/\[\]$/,""),!b){p[f]=g;return}if(p[f]===void 0){p[f]=[g];return}p[f]=[].concat(p[f],g)};case"colon-list-separator":return(f,g,p)=>{if(b=/(:list)$/.exec(f),f=f.replace(/:list$/,""),!b){p[f]=g;return}if(p[f]===void 0){p[f]=[g];return}p[f]=[].concat(p[f],g)};case"comma":case"separator":return(f,g,p)=>{const n=typeof g=="string"&&g.includes(l.arrayFormatSeparator),d=typeof g=="string"&&!n&&E(g,l).includes(l.arrayFormatSeparator);g=d?E(g,l):g;const R=n||d?g.split(l.arrayFormatSeparator).map(j=>E(j,l)):g===null?g:E(g,l);p[f]=R};case"bracket-separator":return(f,g,p)=>{const n=/(\[\])$/.test(f);if(f=f.replace(/\[\]$/,""),!n){p[f]=g&&E(g,l);return}const d=g===null?[]:g.split(l.arrayFormatSeparator).map(R=>E(R,l));if(p[f]===void 0){p[f]=d;return}p[f]=[].concat(p[f],d)};default:return(f,g,p)=>{if(p[f]===void 0){p[f]=g;return}p[f]=[].concat(p[f],g)}}}function w(l){if(typeof l!="string"||l.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(l,b){return b.encode?b.strict?e(l):encodeURIComponent(l):l}function E(l,b){return b.decode?t(l):l}function C(l){return Array.isArray(l)?l.sort():typeof l=="object"?C(Object.keys(l)).sort((b,f)=>Number(b)-Number(f)).map(b=>l[b]):l}function v(l){const b=l.indexOf("#");return b!==-1&&(l=l.slice(0,b)),l}function x(l){let b="";const f=l.indexOf("#");return f!==-1&&(b=l.slice(f)),b}function P(l){l=v(l);const b=l.indexOf("?");return b===-1?"":l.slice(b+1)}function A(l,b){return b.parseNumbers&&!Number.isNaN(Number(l))&&typeof l=="string"&&l.trim()!==""?l=Number(l):b.parseBooleans&&l!==null&&(l.toLowerCase()==="true"||l.toLowerCase()==="false")&&(l=l.toLowerCase()==="true"),l}function L(l,b){b=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},b),w(b.arrayFormatSeparator);const f=h(b),g=Object.create(null);if(typeof l!="string"||(l=l.trim().replace(/^[?#&]/,""),!l))return g;for(const p of l.split("&")){if(p==="")continue;let[n,d]=i(b.decode?p.replace(/\+/g," "):p,"=");d=d===void 0?null:["comma","separator","bracket-separator"].includes(b.arrayFormat)?d:E(d,b),f(E(n,b),d,g)}for(const p of Object.keys(g)){const n=g[p];if(typeof n=="object"&&n!==null)for(const d of Object.keys(n))n[d]=A(n[d],b);else g[p]=A(n,b)}return b.sort===!1?g:(b.sort===!0?Object.keys(g).sort():Object.keys(g).sort(b.sort)).reduce((p,n)=>{const d=g[n];return Boolean(d)&&typeof d=="object"&&!Array.isArray(d)?p[n]=C(d):p[n]=d,p},Object.create(null))}r.extract=P,r.parse=L,r.stringify=(l,b)=>{if(!l)return"";b=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},b),w(b.arrayFormatSeparator);const f=d=>b.skipNull&&o(l[d])||b.skipEmptyString&&l[d]==="",g=c(b),p={};for(const d of Object.keys(l))f(d)||(p[d]=l[d]);const n=Object.keys(p);return b.sort!==!1&&n.sort(b.sort),n.map(d=>{const R=l[d];return R===void 0?"":R===null?m(d,b):Array.isArray(R)?R.length===0&&b.arrayFormat==="bracket-separator"?m(d,b)+"[]":R.reduce(g(d),[]).join("&"):m(d,b)+"="+m(R,b)}).filter(d=>d.length>0).join("&")},r.parseUrl=(l,b)=>{b=Object.assign({decode:!0},b);const[f,g]=i(l,"#");return Object.assign({url:f.split("?")[0]||"",query:L(P(l),b)},b&&b.parseFragmentIdentifier&&g?{fragmentIdentifier:E(g,b)}:{})},r.stringifyUrl=(l,b)=>{b=Object.assign({encode:!0,strict:!0,[u]:!0},b);const f=v(l.url).split("?")[0]||"",g=r.extract(l.url),p=r.parse(g,{sort:!1}),n=Object.assign(p,l.query);let d=r.stringify(n,b);d&&(d=`?${d}`);let R=x(l.url);return l.fragmentIdentifier&&(R=`#${b[u]?m(l.fragmentIdentifier,b):l.fragmentIdentifier}`),`${f}${d}${R}`},r.pick=(l,b,f)=>{f=Object.assign({parseFragmentIdentifier:!0,[u]:!1},f);const{url:g,query:p,fragmentIdentifier:n}=r.parseUrl(l,f);return r.stringifyUrl({url:g,query:s(p,b),fragmentIdentifier:n},f)},r.exclude=(l,b,f)=>{const g=Array.isArray(b)?p=>!b.includes(p):(p,n)=>!b(p,n);return r.pick(l,g,f)}})(rp);const ip={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function sp(r,e){const{message:t,code:i}=ip[r];return{message:e?`${t} ${e}`:t,code:i}}function np(r,e){return Array.isArray(r)?typeof e<"u"&&r.length?r.every(e):!0:!1}function ap(r){var e;const t=(e=r[Object.keys(r)[0]])==null?void 0:e.chains[0];return[t.split(":")[0],t.split(":")[1]]}function $t(r,e){let t;return e.rpcMap&&(t=e.rpcMap[op([r])]),t}function op(r){return Number(r[0].split(":")[1])}class cp{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}async request(e){var t;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":{const i=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";return this.setDefaultChain(parseInt(i,16).toString()),null}case"eth_chainId":return this.getDefaultChainId()}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){if(this.chainId=parseInt(e),!this.httpProviders[e]){const i=t||$t(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}requestAccounts(){return this.getAccounts()}createHttpProvider(e,t){const i=t||$t(e,this.namespace);return typeof i>"u"?void 0:new Dr(new Jr(i))}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}}class hp{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||$t(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||$t(e,this.namespace);return typeof i>"u"?void 0:new Dr(new Jr(i))}}class up{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||$t(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||$t(e,this.namespace);return typeof i>"u"?void 0:new Dr(new Jr(i))}}class lp{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const i=t||$t(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,t){const i=this.createHttpProvider(e,t);i&&(this.httpProviders[e]=i)}createHttpProvider(e,t){const i=t||$t(e,this.namespace);return typeof i>"u"?void 0:new Dr(new Jr(i))}}const Cn="error",fp="wss://relay.walletconnect.com",dp="wc",gp="universal_provider",Pn=`${dp}@${2}:${gp}:`;var pp=Object.defineProperty,yp=Object.defineProperties,bp=Object.getOwnPropertyDescriptors,Rn=Object.getOwnPropertySymbols,mp=Object.prototype.hasOwnProperty,wp=Object.prototype.propertyIsEnumerable,Fn=(r,e,t)=>e in r?pp(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Un=(r,e)=>{for(var t in e||(e={}))mp.call(e,t)&&Fn(r,t,e[t]);if(Rn)for(var t of Rn(e))wp.call(e,t)&&Fn(r,t,e[t]);return r},_p=(r,e)=>yp(r,bp(e));class as{constructor(e){this.events=new yt,this.rpcProviders={},this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Sr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Cn}))}static async init(e){const t=new as(e);return await t.initialize(),t}async request(e,t){const[i,s]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Un({},e),chainId:`${i}:${s}`,topic:this.session.topic})}sendAsync(e,t,i){this.request(e,i).then(s=>t(null,s)).catch(s=>t(s,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:sp("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");const{namespaces:t}=e;return this.setNamespaces(t),this.createProviders(),await this.cleanupPendingPairings(),e.skipPairing===!0?void 0:await this.pair(e.pairingTopic)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces});return t&&(this.uri=t,this.events.emit("display_uri",t)),this.session=await i(),this.onSessionUpdate(),this.onConnect(),this.session}setDefaultChain(e,t){try{const[i,s]=this.validateChain(e);this.getProvider(i).setDefaultChain(s,t)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(np(t)){for(const i of t)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}async checkStorage(){if(this.namespaces=await this.client.core.storage.getItem(`${Pn}/namespaces`)||{},this.namespaces&&this.createProviders(),this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.onSessionUpdate()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await ss.init({logger:this.providerOpts.logger||Cn,relayUrl:this.providerOpts.relayUrl||fp,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{switch(e){case"eip155":this.rpcProviders[e]=new cp({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"solana":this.rpcProviders[e]=new hp({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"cosmos":this.rpcProviders[e]=new up({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"polkadot":break;case"cip34":this.rpcProviders[e]=new lp({client:this.client,namespace:this.namespaces[e],events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:i}=t;i.name==="accountsChanged"?this.events.emit("accountsChanged",i.data):i.name==="chainChanged"?this.onChainChanged(i.data,t.chainId):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var i;const{namespaces:s}=t,o=(i=this.client)==null?void 0:i.session.get(e);this.session=_p(Un({},o),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem(`${Pn}/namespaces`,e),this.namespaces=e}validateChain(e){const[t,i]=(e==null?void 0:e.split(":"))||["",""];if(t&&!Object.keys(this.namespaces).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);return!t||!i?ap(this.namespaces):[t,i]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t){const[i,s]=this.validateChain(t);this.getProvider(i).setDefaultChain(s),this.events.emit("chainChanged",e)}onConnect(){this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0})}}const Cp=as;export{Cp as UniversalProvider,as as default};
